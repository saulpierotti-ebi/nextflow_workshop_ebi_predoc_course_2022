<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="1.5 Getting started | Nextflow workshop - EBI predoc course 2022" />
<meta property="og:type" content="book" />




<meta name="author" content="Saul Pierotti, PhD student in the Birney group (European Bioinformatics Institute)" />

<meta name="date" content="2022-09-29" />


<meta name="description" content="1.5 Getting started | Nextflow workshop - EBI predoc course 2022">

<title>1.5 Getting started | Nextflow workshop - EBI predoc course 2022</title>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/darkly.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="libs/navigation-1.1/tabsets.js"></script>
<script src="libs/navigation-1.1/codefolding.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
/* show arrow before summary tag as in bootstrap
TODO: remove if boostrap in updated in html_document (rmarkdown#1485) */
details > summary {
  display: list-item;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#introduction-to-the-workshop" id="toc-introduction-to-the-workshop">Introduction to the workshop</a></li>
<li class="has-sub"><a href="1-introduction.html#introduction" id="toc-introduction"><span class="toc-section-number">1</span> Introduction</a>
<ul>
<li><a href="1.1-prerequisites.html#prerequisites" id="toc-prerequisites"><span class="toc-section-number">1.1</span> Prerequisites</a></li>
<li><a href="1.2-what-is-nextflow.html#what-is-nextflow" id="toc-what-is-nextflow"><span class="toc-section-number">1.2</span> What is Nextflow?</a></li>
<li><a href="1.3-learning-objectives.html#learning-objectives" id="toc-learning-objectives"><span class="toc-section-number">1.3</span> Learning objectives</a></li>
<li><a href="1.4-setup.html#setup" id="toc-setup"><span class="toc-section-number">1.4</span> Setup</a></li>
<li class="has-sub"><a href="1.5-getting-started.html#getting-started" id="toc-getting-started"><span class="toc-section-number">1.5</span> Getting started</a>
<ul>
<li><a href="1.5-getting-started.html#general-anatomy-of-a-nextflow-workflow" id="toc-general-anatomy-of-a-nextflow-workflow"><span class="toc-section-number">1.5.1</span> General anatomy of a Nextflow workflow</a></li>
<li><a href="1.5-getting-started.html#nextflow-domain-specific-language-versions" id="toc-nextflow-domain-specific-language-versions"><span class="toc-section-number">1.5.2</span> Nextflow domain specific language versions</a></li>
<li><a href="1.5-getting-started.html#core-concepts" id="toc-core-concepts"><span class="toc-section-number">1.5.3</span> Core concepts</a></li>
<li><a href="1.5-getting-started.html#your-first-workflow" id="toc-your-first-workflow"><span class="toc-section-number">1.5.4</span> Your first workflow</a></li>
</ul></li>
</ul></li>
<li><a href="2-additional-resources.html#additional-resources" id="toc-additional-resources"><span class="toc-section-number">2</span> Additional resources</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="getting-started" class="section level2" number="1.5">
<h2><span class="header-section-number">1.5</span> Getting started</h2>
<div id="general-anatomy-of-a-nextflow-workflow" class="section level3" number="1.5.1">
<h3><span class="header-section-number">1.5.1</span> General anatomy of a Nextflow workflow</h3>
<p>A Nextflow workflow is usually represented by a git repository containing all the files describing the workflow logic, configurations, and dependencies.</p>
<p>Text files containing Nextflow code usually have the <code>.nf</code> extension (i.e. <code>my_file.nf</code>).
It does not really matter how you name your files, as long as they contain valid Nextflow code, but for consistency the best practice is to call the file describing the workflow as <code>main.nf</code> and place it at the root of your repository.</p>
<p>The <code>main.nf</code> file can access code from other Nextflow scripts, called sub-workflows, that can have arbitrary names.
The best practice is to place such additional Nextflow scripts under the folder <code>workflows</code> in the root of the repository.
So for example an additional Nextflow script could be named <code>workflows/preprocessing.nf</code>.
We will explore later the usage of sub-workflows, so don’t worry if you don’t understand their purpose yet.</p>
<p>The configurations for the pipeline need to be placed in a file called <code>nextflow.config</code> at the root of the repository.
Note that differently from what was said before regarding <code>main.nf</code>, this name is mandatory for Nextflow to properly recognise the file.
The <code>nextflow.config</code> file can contain for example resource requirements, execution, parameters, and metadata about your workflow.
We will explore more in depth the usage of configurations files in a later section.</p>
<p>Scripts (in any language, for example R or Python) that are used in the execution of specific processes in your pipeline should be placed in the folder <code>bin</code>.
Scripts placed here are automatically recognise by Nextflow during task execution without the need to specify their full path.</p>
<p>Additional files needed for your workflow, for example a table containing some metadata for your samples, are usually placed under the folder <code>assets</code>.
However this is not required and many workflows do not have an <code>assets</code> folder.</p>
<p>Inputs to the workflow are usually defined in a so-called “sample sheet” that should contain the (preferably) absolute file path to the input files end eventual sample-specific parameters for task execution.
Best practice is to have your sample sheet formatted as a <a href="https://www.wikiwand.com/en/Comma-separated_values">csv</a> file with an appropriate header.
Note that the sample sheet is not part of the pipeline itself.
The absolute path to the sample sheet is usually provided to Nextflow either as a command-line parameter or in the <code>nextflow.config</code> file.</p>
<p>In order to execute your workflow, you would run (do not do it now, we still need to write the workflow) <code>nextflow run main.nf</code> at the root of your repository if your workflow is in a file named <code>main.nf</code>.
This would prompt Nextflow to read the <code>main.nf</code> file and eventual sub-workflows, extract the workflow logic from it, load the configurations in <code>nextflow.config</code>, and coordinate the execution of the different steps in your pipeline to produce the final result.</p>
</div>
<div id="nextflow-domain-specific-language-versions" class="section level3" number="1.5.2">
<h3><span class="header-section-number">1.5.2</span> Nextflow domain specific language versions</h3>
<p>Before starting, it is important to know that Nextflow as it was initially developed is referred to as Domain Specific Language 1 (DSL1).
A major change in the Nextflow syntax was done by its developers, and the new syntax is referred to as DSL 2.
In this workshop we will be using exclusively the new DSL2 syntax.</p>
<p>For this reason, you need to add the following line at the top of your <code>main.nf</code> file:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb7-1"><a href="1.5-getting-started.html#cb7-1" aria-hidden="true" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl <span class="op">=</span> <span class="dv">2</span></span></code></pre></div>
<p>So if in the future you will find yourself looking at a Nextflow workflow which is written very differently from what you are used to, it will probably be written according to DSL1 instead of DSL2.</p>
</div>
<div id="core-concepts" class="section level3" number="1.5.3">
<h3><span class="header-section-number">1.5.3</span> Core concepts</h3>
<p>A Nextflow workflow is defined by a set of processes, which execute a single task each, which are coordinate by one or more workflows.
So for example there may be a processes called <code>align_fastq</code> that takes in input a <a href="https://www.wikiwand.com/en/FASTQ_format">fastq</a> file and a <a href="https://www.wikiwand.com/en/Reference_genome">reference genome</a> and uses the software <a href="https://github.com/bwa-mem2/bwa-mem2">bwa-mem2</a> to align it, producing an aligned <a href="https://www.sanger.ac.uk/tool/cram/">cram file</a> in output.</p>
<p>A processes defines as a minimum some output and the command to be executed.
Inputs are usually also defined but there may be processes that do not need any input and instead perform a static computation.
Many additional parameters can be specified for a process, for example the software needed, or how much memory or time is required for its execution.
We will explore processes and their definition more in detail in a later section.</p>
<p>If processes determine what is to be executed and how, workflows instead determine the logic of execution and how different processes communicate with each other.
So for example there may be a workflow called <code>SNP_CALLING</code> that takes a <a href="https://www.wikiwand.com/en/FASTQ_format">fastq</a> file in input, uses the process <code>align_fastq</code> to obtain an aligned <a href="https://www.sanger.ac.uk/tool/cram/">cram file</a>, then gives that cram file in input to another process called <code>gatk_call</code> that uses it to create a <a href="https://www.wikiwand.com/en/Variant_Call_Format">vcf file</a> containing genetic variants.</p>
<p>Processes communicate with each other using so-called “channels”, which are unidirectional <a href="https://www.wikiwand.com/en/FIFO_(computing_and_electronics)">First-In-First-Out (FIFO)</a> queues.
This means that a channel is populated with a set of elements (for example, files) produced by a process in the order in which they are produced.
Then, these elements are consumed one by one by another process in the same order.
Several ways to manipulate, merge, and split channel exist, and we will explore them later.
So for example the workflow that I described above may define an input channel containing the <a href="https://www.wikiwand.com/en/FASTQ_format">fastq</a> files in input, and a channel connecting the output of <code>align_fastq</code> to the input of <code>gatk_call</code>.
Note that channels are unidirectional: communication happens only in one direction, from outputs to inputs.</p>
</div>
<div id="your-first-workflow" class="section level3" number="1.5.4">
<h3><span class="header-section-number">1.5.4</span> Your first workflow</h3>
<p>Now that you know the basics of what a Nextflow workflow is, we will write a simple workflow and we will execute it.</p>
<p>First of all, open the file <code>main.nf</code> that you created before at the root of your repository in a text editor and add the following to it</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb8-1"><a href="1.5-getting-started.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">// this is a comment</span></span>
<span id="cb8-2"><a href="1.5-getting-started.html#cb8-2" aria-hidden="true" tabindex="-1"></a>process say_hello <span class="op">{</span></span>
<span id="cb8-3"><a href="1.5-getting-started.html#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// comments can be written anywhere</span></span>
<span id="cb8-4"><a href="1.5-getting-started.html#cb8-4" aria-hidden="true" tabindex="-1"></a>    output<span class="op">:</span></span>
<span id="cb8-5"><a href="1.5-getting-started.html#cb8-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;hello_world.txt&quot;</span></span>
<span id="cb8-6"><a href="1.5-getting-started.html#cb8-6" aria-hidden="true" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb8-7"><a href="1.5-getting-started.html#cb8-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb8-8"><a href="1.5-getting-started.html#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="st">        echo &quot;This is the EBI predoc course&quot; &gt; hello_world.txt</span></span>
<span id="cb8-9"><a href="1.5-getting-started.html#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb8-10"><a href="1.5-getting-started.html#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb8-11"><a href="1.5-getting-started.html#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="1.5-getting-started.html#cb8-12" aria-hidden="true" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb8-13"><a href="1.5-getting-started.html#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">say_hello</span><span class="op">()</span></span>
<span id="cb8-14"><a href="1.5-getting-started.html#cb8-14" aria-hidden="true" tabindex="-1"></a>    say_hello<span class="op">.</span>out<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span>
<span id="cb8-15"><a href="1.5-getting-started.html#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>If you want to see how your <code>main.nf</code> should look like at this stage open this hidden section</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode groovy foldable"><code class="sourceCode groovy"><span id="cb9-1"><a href="1.5-getting-started.html#cb9-1" aria-hidden="true" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb9-2"><a href="1.5-getting-started.html#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="1.5-getting-started.html#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">// this is a comment</span></span>
<span id="cb9-4"><a href="1.5-getting-started.html#cb9-4" aria-hidden="true" tabindex="-1"></a>process say_hello <span class="op">{</span></span>
<span id="cb9-5"><a href="1.5-getting-started.html#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// comments can be written anywhere</span></span>
<span id="cb9-6"><a href="1.5-getting-started.html#cb9-6" aria-hidden="true" tabindex="-1"></a>    output<span class="op">:</span></span>
<span id="cb9-7"><a href="1.5-getting-started.html#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;hello_world.txt&quot;</span></span>
<span id="cb9-8"><a href="1.5-getting-started.html#cb9-8" aria-hidden="true" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb9-9"><a href="1.5-getting-started.html#cb9-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb9-10"><a href="1.5-getting-started.html#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="st">        echo &quot;This is the EBI predoc course&quot; &gt; hello_world.txt</span></span>
<span id="cb9-11"><a href="1.5-getting-started.html#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb9-12"><a href="1.5-getting-started.html#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb9-13"><a href="1.5-getting-started.html#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="1.5-getting-started.html#cb9-14" aria-hidden="true" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb9-15"><a href="1.5-getting-started.html#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">say_hello</span><span class="op">()</span></span>
<span id="cb9-16"><a href="1.5-getting-started.html#cb9-16" aria-hidden="true" tabindex="-1"></a>    say_hello<span class="op">.</span>out<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span>
<span id="cb9-17"><a href="1.5-getting-started.html#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Now run the workflow executing from the root of your repository the following</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="1.5-getting-started.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">nextflow</span> run main.nf</span></code></pre></div>
<p>You should see a bunch of information about your workflow and finally you will see the name of the file we just created, <code>hello_world.txt</code>, appear on your terminal.</p>

</div>
</div>
<!-- </div> -->
<p style="text-align: center;">
<a href="1.4-setup.html"><button class="btn btn-default">Previous</button></a>
<a href="2-additional-resources.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
