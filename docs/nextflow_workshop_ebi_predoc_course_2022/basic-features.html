<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Basic features | Nextflow workshop - EBI predoc course 2022</title>
  <meta name="description" content="2 Basic features | Nextflow workshop - EBI predoc course 2022" />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Basic features | Nextflow workshop - EBI predoc course 2022" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="saulpierotti-ebi/saulpierotti-ebi.github.io" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Basic features | Nextflow workshop - EBI predoc course 2022" />
  
  
  

<meta name="author" content="Saul Pierotti, PhD student in the Birney group (European Bioinformatics Institute)" />


<meta name="date" content="2022-10-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introduction.html"/>
<link rel="next" href="basic-challenge.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link rel="icon" href="images/favicon.ico">


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  { color: #cccccc; background-color: #303030; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ffcfaf; } /* Alert */
code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #dca3a3; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #f0dfaf; } /* ControlFlow */
code span.ch { color: #dca3a3; } /* Char */
code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code span.co { color: #7f9f7f; } /* Comment */
code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code span.do { color: #7f9f7f; } /* Documentation */
code span.dt { color: #dfdfbf; } /* DataType */
code span.dv { color: #dcdccc; } /* DecVal */
code span.er { color: #c3bf9f; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #c0bed1; } /* Float */
code span.fu { color: #efef8f; } /* Function */
code span.im { } /* Import */
code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
code span.kw { color: #f0dfaf; } /* Keyword */
code span.op { color: #f0efd0; } /* Operator */
code span.ot { color: #efef8f; } /* Other */
code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code span.sc { color: #dca3a3; } /* SpecialChar */
code span.ss { color: #cc9393; } /* SpecialString */
code span.st { color: #cc9393; } /* String */
code span.va { } /* Variable */
code span.vs { color: #cc9393; } /* VerbatimString */
code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#prerequisites"><i class="fa fa-check"></i><b>1.1</b> Prerequisites</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#what-is-nextflow"><i class="fa fa-check"></i><b>1.2</b> What is Nextflow?</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#learning-objectives"><i class="fa fa-check"></i><b>1.3</b> Learning objectives</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#setup"><i class="fa fa-check"></i><b>1.4</b> Setup</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#getting-started"><i class="fa fa-check"></i><b>1.5</b> Getting started</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="introduction.html"><a href="introduction.html#general-anatomy-of-a-nextflow-workflow"><i class="fa fa-check"></i><b>1.5.1</b> General anatomy of a Nextflow workflow</a></li>
<li class="chapter" data-level="1.5.2" data-path="introduction.html"><a href="introduction.html#nextflow-domain-specific-language-versions"><i class="fa fa-check"></i><b>1.5.2</b> Nextflow domain-specific language versions</a></li>
<li class="chapter" data-level="1.5.3" data-path="introduction.html"><a href="introduction.html#core-concepts"><i class="fa fa-check"></i><b>1.5.3</b> Core concepts</a></li>
<li class="chapter" data-level="1.5.4" data-path="introduction.html"><a href="introduction.html#your-first-workflow"><i class="fa fa-check"></i><b>1.5.4</b> Your first workflow</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="basic-features.html"><a href="basic-features.html"><i class="fa fa-check"></i><b>2</b> Basic features</a>
<ul>
<li class="chapter" data-level="2.1" data-path="basic-features.html"><a href="basic-features.html#multiple-processes-and-publication-of-workflow-outputs"><i class="fa fa-check"></i><b>2.1</b> Multiple processes and publication of workflow outputs</a></li>
<li class="chapter" data-level="2.2" data-path="basic-features.html"><a href="basic-features.html#creating-channels-and-specifying-pipeline-parameters"><i class="fa fa-check"></i><b>2.2</b> Creating channels and specifying pipeline parameters</a></li>
<li class="chapter" data-level="2.3" data-path="basic-features.html"><a href="basic-features.html#multiple-input-files"><i class="fa fa-check"></i><b>2.3</b> Multiple input files</a></li>
<li class="chapter" data-level="2.4" data-path="basic-features.html"><a href="basic-features.html#using-a-sample-sheet-and-value-channels"><i class="fa fa-check"></i><b>2.4</b> Using a sample sheet and value channels</a></li>
<li class="chapter" data-level="2.5" data-path="basic-features.html"><a href="basic-features.html#the-tuple-input-qualifier-and-joining-channels"><i class="fa fa-check"></i><b>2.5</b> The <code>tuple</code> input qualifier and joining channels</a></li>
<li class="chapter" data-level="2.6" data-path="basic-features.html"><a href="basic-features.html#software-dependencies"><i class="fa fa-check"></i><b>2.6</b> Software dependencies</a></li>
<li class="chapter" data-level="2.7" data-path="basic-features.html"><a href="basic-features.html#resource-allocation"><i class="fa fa-check"></i><b>2.7</b> Resource allocation</a></li>
<li class="chapter" data-level="2.8" data-path="basic-features.html"><a href="basic-features.html#the-resume-feature"><i class="fa fa-check"></i><b>2.8</b> The resume feature</a></li>
<li class="chapter" data-level="2.9" data-path="basic-features.html"><a href="basic-features.html#nf-core-pipelines"><i class="fa fa-check"></i><b>2.9</b> nf-core pipelines</a></li>
<li class="chapter" data-level="2.10" data-path="basic-features.html"><a href="basic-features.html#labels"><i class="fa fa-check"></i><b>2.10</b> Labels</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="basic-challenge.html"><a href="basic-challenge.html"><i class="fa fa-check"></i><b>3</b> Basic challenge</a></li>
<li class="chapter" data-level="4" data-path="advanced-features.html"><a href="advanced-features.html"><i class="fa fa-check"></i><b>4</b> Advanced features</a>
<ul>
<li class="chapter" data-level="4.1" data-path="advanced-features.html"><a href="advanced-features.html#process-inputs"><i class="fa fa-check"></i><b>4.1</b> Process inputs</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="advanced-features.html"><a href="advanced-features.html#input-of-type-val"><i class="fa fa-check"></i><b>4.1.1</b> Input of type <code>val</code></a></li>
<li class="chapter" data-level="4.1.2" data-path="advanced-features.html"><a href="advanced-features.html#input-of-type-path"><i class="fa fa-check"></i><b>4.1.2</b> Input of type <code>path</code></a></li>
<li class="chapter" data-level="4.1.3" data-path="advanced-features.html"><a href="advanced-features.html#input-of-type-tuple"><i class="fa fa-check"></i><b>4.1.3</b> Input of type <code>tuple</code></a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="advanced-features.html"><a href="advanced-features.html#process-outputs"><i class="fa fa-check"></i><b>4.2</b> Process outputs</a></li>
<li class="chapter" data-level="4.3" data-path="advanced-features.html"><a href="advanced-features.html#the-groovy-programming-language"><i class="fa fa-check"></i><b>4.3</b> The Groovy programming language</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="advanced-features.html"><a href="advanced-features.html#closures"><i class="fa fa-check"></i><b>4.3.1</b> Closures</a></li>
<li class="chapter" data-level="4.3.2" data-path="advanced-features.html"><a href="advanced-features.html#conditional-statements"><i class="fa fa-check"></i><b>4.3.2</b> Conditional statements</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="advanced-features.html"><a href="advanced-features.html#channel-factories"><i class="fa fa-check"></i><b>4.4</b> Channel factories</a></li>
<li class="chapter" data-level="4.5" data-path="advanced-features.html"><a href="advanced-features.html#operators"><i class="fa fa-check"></i><b>4.5</b> Operators</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="advanced-features.html"><a href="advanced-features.html#the-view-operator"><i class="fa fa-check"></i><b>4.5.1</b> The <code>view</code> operator</a></li>
<li class="chapter" data-level="4.5.2" data-path="advanced-features.html"><a href="advanced-features.html#the-map-operator"><i class="fa fa-check"></i><b>4.5.2</b> The <code>map</code> operator</a></li>
<li class="chapter" data-level="4.5.3" data-path="advanced-features.html"><a href="advanced-features.html#the-set-operator"><i class="fa fa-check"></i><b>4.5.3</b> The <code>set</code> operator</a></li>
<li class="chapter" data-level="4.5.4" data-path="advanced-features.html"><a href="advanced-features.html#the-splitcsv-operator"><i class="fa fa-check"></i><b>4.5.4</b> The <code>splitCsv</code> operator</a></li>
<li class="chapter" data-level="4.5.5" data-path="advanced-features.html"><a href="advanced-features.html#the-flatten-operator"><i class="fa fa-check"></i><b>4.5.5</b> The <code>flatten</code> operator</a></li>
<li class="chapter" data-level="4.5.6" data-path="advanced-features.html"><a href="advanced-features.html#the-collect-operator"><i class="fa fa-check"></i><b>4.5.6</b> The <code>collect</code> operator</a></li>
<li class="chapter" data-level="4.5.7" data-path="advanced-features.html"><a href="advanced-features.html#the-filter-operator"><i class="fa fa-check"></i><b>4.5.7</b> The <code>filter</code> operator</a></li>
<li class="chapter" data-level="4.5.8" data-path="advanced-features.html"><a href="advanced-features.html#the-first-operator"><i class="fa fa-check"></i><b>4.5.8</b> The <code>first</code> operator</a></li>
<li class="chapter" data-level="4.5.9" data-path="advanced-features.html"><a href="advanced-features.html#the-combine-operator"><i class="fa fa-check"></i><b>4.5.9</b> The <code>combine</code> operator</a></li>
<li class="chapter" data-level="4.5.10" data-path="advanced-features.html"><a href="advanced-features.html#the-grouptuple-operator"><i class="fa fa-check"></i><b>4.5.10</b> The <code>groupTuple</code> operator</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="advanced-features.html"><a href="advanced-features.html#implicit-variables"><i class="fa fa-check"></i><b>4.6</b> Implicit variables</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="advanced-features.html"><a href="advanced-features.html#script-implicit-variables-available-in-main.nf"><i class="fa fa-check"></i><b>4.6.1</b> Script implicit variables (available in <code>main.nf</code>)</a></li>
<li class="chapter" data-level="4.6.2" data-path="advanced-features.html"><a href="advanced-features.html#configuration-implicit-variables-available-in-nextflow.config"><i class="fa fa-check"></i><b>4.6.2</b> Configuration implicit variables (available in <code>nextflow.config</code>)</a></li>
<li class="chapter" data-level="4.6.3" data-path="advanced-features.html"><a href="advanced-features.html#process-implicit-variables-defined-within-a-process"><i class="fa fa-check"></i><b>4.6.3</b> Process implicit variables (defined within a process)</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="advanced-features.html"><a href="advanced-features.html#directives"><i class="fa fa-check"></i><b>4.7</b> Directives</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="advanced-features.html"><a href="advanced-features.html#the-conda-directive"><i class="fa fa-check"></i><b>4.7.1</b> The <code>conda</code> directive</a></li>
<li class="chapter" data-level="4.7.2" data-path="advanced-features.html"><a href="advanced-features.html#the-container-directive"><i class="fa fa-check"></i><b>4.7.2</b> The <code>container</code> directive</a></li>
<li class="chapter" data-level="4.7.3" data-path="advanced-features.html"><a href="advanced-features.html#the-cpus-memory-and-time-directives"><i class="fa fa-check"></i><b>4.7.3</b> The <code>cpus</code>, <code>memory</code>, and <code>time</code> directives</a></li>
<li class="chapter" data-level="4.7.4" data-path="advanced-features.html"><a href="advanced-features.html#the-label-directive"><i class="fa fa-check"></i><b>4.7.4</b> The <code>label</code> directive</a></li>
<li class="chapter" data-level="4.7.5" data-path="advanced-features.html"><a href="advanced-features.html#the-debug-directive"><i class="fa fa-check"></i><b>4.7.5</b> The <code>debug</code> directive</a></li>
<li class="chapter" data-level="4.7.6" data-path="advanced-features.html"><a href="advanced-features.html#the-cache-directive"><i class="fa fa-check"></i><b>4.7.6</b> The <code>cache</code> directive</a></li>
<li class="chapter" data-level="4.7.7" data-path="advanced-features.html"><a href="advanced-features.html#the-errorstrategy-directive"><i class="fa fa-check"></i><b>4.7.7</b> The <code>errorStrategy</code> directive</a></li>
<li class="chapter" data-level="4.7.8" data-path="advanced-features.html"><a href="advanced-features.html#the-publishdir-directive"><i class="fa fa-check"></i><b>4.7.8</b> The <code>publishDir</code> directive</a></li>
<li class="chapter" data-level="4.7.9" data-path="advanced-features.html"><a href="advanced-features.html#the-executor-and-queue-directives"><i class="fa fa-check"></i><b>4.7.9</b> The <code>executor</code> and <code>queue</code> directives</a></li>
<li class="chapter" data-level="4.7.10" data-path="advanced-features.html"><a href="advanced-features.html#the-ext-directive"><i class="fa fa-check"></i><b>4.7.10</b> The <code>ext</code> directive</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="advanced-features.html"><a href="advanced-features.html#advanced-workflow-configuration"><i class="fa fa-check"></i><b>4.8</b> Advanced workflow configuration</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="advanced-features.html"><a href="advanced-features.html#configuration-files-and-command-line-parameters"><i class="fa fa-check"></i><b>4.8.1</b> Configuration files and command line parameters</a></li>
<li class="chapter" data-level="4.8.2" data-path="advanced-features.html"><a href="advanced-features.html#configuration-profiles"><i class="fa fa-check"></i><b>4.8.2</b> Configuration profiles</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="advanced-features.html"><a href="advanced-features.html#sub-workflows"><i class="fa fa-check"></i><b>4.9</b> Sub-workflows</a></li>
<li class="chapter" data-level="4.10" data-path="advanced-features.html"><a href="advanced-features.html#nextflow-tower"><i class="fa fa-check"></i><b>4.10</b> Nextflow Tower</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="advanced-challenge.html"><a href="advanced-challenge.html"><i class="fa fa-check"></i><b>5</b> Advanced challenge</a>
<ul>
<li class="chapter" data-level="5.1" data-path="advanced-challenge.html"><a href="advanced-challenge.html#setup-1"><i class="fa fa-check"></i><b>5.1</b> Setup</a></li>
<li class="chapter" data-level="5.2" data-path="advanced-challenge.html"><a href="advanced-challenge.html#solution"><i class="fa fa-check"></i><b>5.2</b> Solution</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="additional-resources.html"><a href="additional-resources.html"><i class="fa fa-check"></i>Additional resources</a></li>
<li class="chapter" data-level="" data-path="credits.html"><a href="credits.html"><i class="fa fa-check"></i>Credits</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Nextflow workshop - EBI predoc course 2022</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="basic-features" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> Basic features<a href="basic-features.html#basic-features" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="multiple-processes-and-publication-of-workflow-outputs" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Multiple processes and publication of workflow outputs<a href="basic-features.html#multiple-processes-and-publication-of-workflow-outputs" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s now step up a bit the complexity and write a workflow containing two processes that communicate with each other.
Add the following process to your <code>main.nf</code> file.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb13-1"><a href="basic-features.html#cb13-1" aria-hidden="true" tabindex="-1"></a>process duplicate_lines <span class="op">{</span></span>
<span id="cb13-2"><a href="basic-features.html#cb13-2" aria-hidden="true" tabindex="-1"></a>    publishDir <span class="st">&quot;../nextflow_output/duplicate_lines&quot;</span></span>
<span id="cb13-3"><a href="basic-features.html#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="basic-features.html#cb13-4" aria-hidden="true" tabindex="-1"></a>    input<span class="op">:</span></span>
<span id="cb13-5"><a href="basic-features.html#cb13-5" aria-hidden="true" tabindex="-1"></a>        path my_file</span>
<span id="cb13-6"><a href="basic-features.html#cb13-6" aria-hidden="true" tabindex="-1"></a>    output<span class="op">:</span></span>
<span id="cb13-7"><a href="basic-features.html#cb13-7" aria-hidden="true" tabindex="-1"></a>        path <span class="st">&quot;</span><span class="ss">${</span>my_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.duplicated.txt&quot;</span></span>
<span id="cb13-8"><a href="basic-features.html#cb13-8" aria-hidden="true" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb13-9"><a href="basic-features.html#cb13-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb13-10"><a href="basic-features.html#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="st">        cat </span><span class="ss">$my_file</span><span class="st"> </span><span class="ss">$my_file</span><span class="st"> &gt; </span><span class="ss">${</span>my_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.duplicated.txt</span></span>
<span id="cb13-11"><a href="basic-features.html#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb13-12"><a href="basic-features.html#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>And modify your workflow block as follows</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb14-1"><a href="basic-features.html#cb14-1" aria-hidden="true" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb14-2"><a href="basic-features.html#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">say_hello</span><span class="op">()</span></span>
<span id="cb14-3"><a href="basic-features.html#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">duplicate_lines</span><span class="op">(</span> say_hello<span class="op">.</span>out <span class="op">)</span></span>
<span id="cb14-4"><a href="basic-features.html#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>If you want to see how your <code>main.nf</code> should look like at this stage open this hidden section</p>
<details>
<summary>
Code
</summary>
<div class="sourceCode" id="cb15"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb15-1"><a href="basic-features.html#cb15-1" aria-hidden="true" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb15-2"><a href="basic-features.html#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="basic-features.html#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">// this is a comment</span></span>
<span id="cb15-4"><a href="basic-features.html#cb15-4" aria-hidden="true" tabindex="-1"></a>process say_hello <span class="op">{</span></span>
<span id="cb15-5"><a href="basic-features.html#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// comments can be written anywhere</span></span>
<span id="cb15-6"><a href="basic-features.html#cb15-6" aria-hidden="true" tabindex="-1"></a>    output<span class="op">:</span></span>
<span id="cb15-7"><a href="basic-features.html#cb15-7" aria-hidden="true" tabindex="-1"></a>        path <span class="st">&quot;hello_world.txt&quot;</span></span>
<span id="cb15-8"><a href="basic-features.html#cb15-8" aria-hidden="true" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb15-9"><a href="basic-features.html#cb15-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb15-10"><a href="basic-features.html#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="st">        echo &quot;This is the EBI predoc course&quot; &gt; hello_world.txt</span></span>
<span id="cb15-11"><a href="basic-features.html#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb15-12"><a href="basic-features.html#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb15-13"><a href="basic-features.html#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="basic-features.html#cb15-14" aria-hidden="true" tabindex="-1"></a>process duplicate_lines <span class="op">{</span></span>
<span id="cb15-15"><a href="basic-features.html#cb15-15" aria-hidden="true" tabindex="-1"></a>    publishDir <span class="st">&quot;../nextflow_output/duplicate_lines&quot;</span></span>
<span id="cb15-16"><a href="basic-features.html#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="basic-features.html#cb15-17" aria-hidden="true" tabindex="-1"></a>    input<span class="op">:</span></span>
<span id="cb15-18"><a href="basic-features.html#cb15-18" aria-hidden="true" tabindex="-1"></a>        path my_file</span>
<span id="cb15-19"><a href="basic-features.html#cb15-19" aria-hidden="true" tabindex="-1"></a>    output<span class="op">:</span></span>
<span id="cb15-20"><a href="basic-features.html#cb15-20" aria-hidden="true" tabindex="-1"></a>        path <span class="st">&quot;</span><span class="ss">${</span>my_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.duplicated.txt&quot;</span></span>
<span id="cb15-21"><a href="basic-features.html#cb15-21" aria-hidden="true" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb15-22"><a href="basic-features.html#cb15-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb15-23"><a href="basic-features.html#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="st">        cat </span><span class="ss">$my_file</span><span class="st"> </span><span class="ss">$my_file</span><span class="st"> &gt; </span><span class="ss">${</span>my_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.duplicated.txt</span></span>
<span id="cb15-24"><a href="basic-features.html#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb15-25"><a href="basic-features.html#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb15-26"><a href="basic-features.html#cb15-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-27"><a href="basic-features.html#cb15-27" aria-hidden="true" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb15-28"><a href="basic-features.html#cb15-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">say_hello</span><span class="op">()</span></span>
<span id="cb15-29"><a href="basic-features.html#cb15-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">duplicate_lines</span><span class="op">(</span> say_hello<span class="op">.</span>out <span class="op">)</span></span>
<span id="cb15-30"><a href="basic-features.html#cb15-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</details>
<p>Now run again the workflow with <code>nextflow run main.nf</code>.
This time your workflow will not print anything since we omitted the <code>view()</code> operator.
However, if you read the output file content with this command</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="basic-features.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> ../nextflow_output/duplicate_lines/hello_world.duplicated.txt</span></code></pre></div>
<p>You should see the following output in your terminal</p>
<pre><code>This is the EBI predoc course
This is the EBI predoc course</code></pre>
<p>So as you see, the content of the <code>hello_world.txt</code> file that we created before has been duplicated so that it appears twice and it has been placed on a new file, <code>../nextflow_output/duplicate_lines/hello_world.duplicated.txt</code>.</p>
<p>Let’s analyse what happened this time:</p>
<ul>
<li>We created another process called <code>duplicate_lines</code> which duplicates a given file thanks to its <code>script:</code> block containing the command <code>cat $my_file $my_file &gt; ${my_file.simpleName}.duplicated.txt</code></li>
<li>The process <code>duplicate_lines</code> declares an <code>input:</code> block. The input block is similar to the output block that we saw before in that it can use the <code>path</code> qualifier to declare the input to be a file. However, what comes after <code>path</code> does not need to be a real filename, it is just a variable name (note that it is not quoted). Nextflow replaces that variable with the real name of the file given in input.</li>
<li>In the script and output blocks we can refer to the inputs by specifying the variable <code>$my_file</code>. Note that we need to use the same name used in the input declaration.
<ul>
<li>It is possible to enclose the variable name in curly braces to demark it from other text. So <code>${my_file}</code> is equivalent to <code>$my_file</code>.</li>
<li>We applied the operator <code>simpleName</code> to the variable <code>$my_file</code> by writing <code>${my_file.simpleName}</code>. This removes the path and the extension from <code>my_file</code>, so that we can use it to name our output file (if <code>$my_file</code> contains the value <code>"/some/path/hello_world.txt"</code>, then <code>${my_file.simpleName}</code> contains only <code>hello_world</code>).</li>
</ul></li>
<li>We used a new directive in the process <code>duplicate_lines</code>, called <code>publishDir</code>. This specifies the folder where the output of the process should be placed at the end of the execution. This is usually done to put the final outputs of your workflow in a meaningful directory structure. In our case, <code>publishDir "../nextflow_output/duplicate_lines"</code> places <code>${my_file.simpleName}.duplicated.txt</code> in the folder <code>../nextflow_output/duplicate_lines</code></li>
<li>In the workflow block we called the process <code>duplicate_lines</code> with the channel <code>say_hello.out</code> as an argument. So the output of the process <code>say_hello</code> is used as an input for the process <code>duplicate_lines</code>. Note that the number of arguments provided to a process must match the number of arguments declared in its input block.</li>
</ul>
</div>
<div id="creating-channels-and-specifying-pipeline-parameters" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Creating channels and specifying pipeline parameters<a href="basic-features.html#creating-channels-and-specifying-pipeline-parameters" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The workflow that we wrote works as expected but it is not very useful since we cannot specify dynamically its input files. We will now learn how to use pipeline parameters to specify an external input file for the whole workflow and how to use channel factories to feed inputs to our processes.</p>
<p>First, create a text file called <code>../nextflow_inputs/a_file.txt</code> containing the string <code>"This is the file content"</code></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="basic-features.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> ../nextflow_inputs</span>
<span id="cb18-2"><a href="basic-features.html#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;This is the file content&quot;</span> <span class="op">&gt;</span> ../nextflow_inputs/a_file.txt</span></code></pre></div>
<p>Modify the workflow as follows</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb19-1"><a href="basic-features.html#cb19-1" aria-hidden="true" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb19-2"><a href="basic-features.html#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span> params<span class="op">.</span>input_file <span class="op">).</span><span class="fu">set</span><span class="op">{</span> input_ch <span class="op">}</span></span>
<span id="cb19-3"><a href="basic-features.html#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">duplicate_lines</span><span class="op">(</span> input_ch <span class="op">)</span></span>
<span id="cb19-4"><a href="basic-features.html#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>If you want to see how your <code>main.nf</code> should look like at this stage open this hidden section</p>
<details>
<summary>
Code
</summary>
<div class="sourceCode" id="cb20"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb20-1"><a href="basic-features.html#cb20-1" aria-hidden="true" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb20-2"><a href="basic-features.html#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="basic-features.html#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">// this is a comment</span></span>
<span id="cb20-4"><a href="basic-features.html#cb20-4" aria-hidden="true" tabindex="-1"></a>process say_hello <span class="op">{</span></span>
<span id="cb20-5"><a href="basic-features.html#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// comments can be written anywhere</span></span>
<span id="cb20-6"><a href="basic-features.html#cb20-6" aria-hidden="true" tabindex="-1"></a>    output<span class="op">:</span></span>
<span id="cb20-7"><a href="basic-features.html#cb20-7" aria-hidden="true" tabindex="-1"></a>        path <span class="st">&quot;hello_world.txt&quot;</span></span>
<span id="cb20-8"><a href="basic-features.html#cb20-8" aria-hidden="true" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb20-9"><a href="basic-features.html#cb20-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb20-10"><a href="basic-features.html#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="st">        echo &quot;This is the EBI predoc course&quot; &gt; hello_world.txt</span></span>
<span id="cb20-11"><a href="basic-features.html#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb20-12"><a href="basic-features.html#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb20-13"><a href="basic-features.html#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="basic-features.html#cb20-14" aria-hidden="true" tabindex="-1"></a>process duplicate_lines <span class="op">{</span></span>
<span id="cb20-15"><a href="basic-features.html#cb20-15" aria-hidden="true" tabindex="-1"></a>    publishDir <span class="st">&quot;../nextflow_output/duplicate_lines&quot;</span></span>
<span id="cb20-16"><a href="basic-features.html#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="basic-features.html#cb20-17" aria-hidden="true" tabindex="-1"></a>    input<span class="op">:</span></span>
<span id="cb20-18"><a href="basic-features.html#cb20-18" aria-hidden="true" tabindex="-1"></a>        path my_file</span>
<span id="cb20-19"><a href="basic-features.html#cb20-19" aria-hidden="true" tabindex="-1"></a>    output<span class="op">:</span></span>
<span id="cb20-20"><a href="basic-features.html#cb20-20" aria-hidden="true" tabindex="-1"></a>        path <span class="st">&quot;</span><span class="ss">${</span>my_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.duplicated.txt&quot;</span></span>
<span id="cb20-21"><a href="basic-features.html#cb20-21" aria-hidden="true" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb20-22"><a href="basic-features.html#cb20-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb20-23"><a href="basic-features.html#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="st">        cat </span><span class="ss">$my_file</span><span class="st"> </span><span class="ss">$my_file</span><span class="st"> &gt; </span><span class="ss">${</span>my_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.duplicated.txt</span></span>
<span id="cb20-24"><a href="basic-features.html#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb20-25"><a href="basic-features.html#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb20-26"><a href="basic-features.html#cb20-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-27"><a href="basic-features.html#cb20-27" aria-hidden="true" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb20-28"><a href="basic-features.html#cb20-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span> params<span class="op">.</span>input_file <span class="op">).</span><span class="fu">set</span><span class="op">{</span> input_ch <span class="op">}</span></span>
<span id="cb20-29"><a href="basic-features.html#cb20-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">duplicate_lines</span><span class="op">(</span> input_ch <span class="op">)</span></span>
<span id="cb20-30"><a href="basic-features.html#cb20-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</details>
<p>Now open the file <code>nextflow.config</code> and add the following</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb21-1"><a href="basic-features.html#cb21-1" aria-hidden="true" tabindex="-1"></a>params <span class="op">{</span></span>
<span id="cb21-2"><a href="basic-features.html#cb21-2" aria-hidden="true" tabindex="-1"></a>  input_file <span class="op">=</span> <span class="st">&quot;../nextflow_inputs/a_file.txt&quot;</span></span>
<span id="cb21-3"><a href="basic-features.html#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>If you want to see how your <code>nextflow.config</code> should look like at this stage open this hidden section</p>
<details>
<summary>
Code
</summary>
<div class="sourceCode" id="cb22"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb22-1"><a href="basic-features.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">// you can also put comments in nextflow.config</span></span>
<span id="cb22-2"><a href="basic-features.html#cb22-2" aria-hidden="true" tabindex="-1"></a>workDir <span class="op">=</span> <span class="st">&quot;../nextflow_workdir&quot;</span></span>
<span id="cb22-3"><a href="basic-features.html#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="basic-features.html#cb22-4" aria-hidden="true" tabindex="-1"></a>params <span class="op">{</span></span>
<span id="cb22-5"><a href="basic-features.html#cb22-5" aria-hidden="true" tabindex="-1"></a>  input_file <span class="op">=</span> <span class="st">&quot;../nextflow_inputs/a_file.txt&quot;</span></span>
<span id="cb22-6"><a href="basic-features.html#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</details>
<p>Now run again the workflow with <code>nextflow run main.nf</code>.
This time if you examine the folder <code>../nextflow_output/duplicate_lines</code> you will find a file called <code>a_file.duplicated.txt</code>. Let’s see its content.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="basic-features.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> ../nextflow_output/duplicate_lines/a_file.duplicated.txt</span></code></pre></div>
<p>This should print</p>
<pre><code>This is the file content
This is the file content</code></pre>
<p>So the content of the file that we created before, <code>a_file.txt</code> was duplicated and placed in the file <code>a_file.duplicated.txt</code> in the folder <code>../nextflow_output/duplicate_lines</code>.
Let’s examine what happened:</p>
<ul>
<li>In <code>nextflow.config</code>, we declared a <code>params</code> block. Any variable written inside this block, like <code>input_file = "../nextflow_inputs/a_file.txt"</code>, is accessible in the workflow by writing <code>params.&lt;variable_name&gt;</code>, so <code>params.input_file</code> in this case.</li>
<li>In <code>main.nf</code>, we wrote <code>Channel.fromPath( params.input_file )</code>. This uses the channel factory <code>Channel.fromPath</code> to create a new channel using the content of <code>params.input_file</code>. The <code>Channel.fromPath</code> factory interprets its argument to be the path to a file.</li>
<li>After <code>Channel.fromPath( params.input_file )</code> we added <code>set{ input_ch }</code> (note the curly braces: it is a <a href="https://www.wikiwand.com/en/Closure_(computer_programming)">closure</a>, we will explore later what does it mean). This assigns to the newly created channel the name <code>input_ch</code></li>
<li>We then used the channel <code>input_ch</code> as an input for the process <code>duplicate_lines</code> in the statement <code>duplicate_lines( input_ch )</code>. Since the channel <code>input_ch</code> contains the variable <code>params.input_file</code>, which we declared to contain the value <code>../nextflow_inputs/a_file.txt</code>, this file is given in input to <code>duplicate_lines</code></li>
<li><code>duplicate_lines</code> performed its function as before, putting its output in <code>../nextflow_output/duplicate_lines</code></li>
</ul>
<p>Instead of hard-coding parameters in <code>nextflow.config</code>, it is also possible to pass them on the command line. So for example we could have omitted the <code>params</code> block in <code>nextflow.config</code> and run</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="basic-features.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">nextflow</span> run main.nf <span class="at">--input_file</span> ../nextflow_inputs/a_file.txt</span></code></pre></div>
<p>This produces the same result. Note that pipeline parameters need to be specified with two prepending dashes (<code>--my_parameter</code>).
This differentiates them from command line options for Nextflow itself, such as <code>-dry-run</code>, which use a single dash.</p>
</div>
<div id="multiple-input-files" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Multiple input files<a href="basic-features.html#multiple-input-files" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We are now able to process a single file with our pipeline, but what if we have many files that we need to process in the same way?
One approach for this is to use a <a href="https://www.wikiwand.com/en/Glob_(programming)">glob pattern</a> as an input.</p>
<p>Let’s create a bunch of files to use in input</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="basic-features.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;This is content of file 1&quot;</span> <span class="op">&gt;</span> ../nextflow_inputs/set_of_files_1.txt</span>
<span id="cb26-2"><a href="basic-features.html#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;This is content of file 2&quot;</span> <span class="op">&gt;</span> ../nextflow_inputs/set_of_files_2.txt</span>
<span id="cb26-3"><a href="basic-features.html#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;This is content of file 3&quot;</span> <span class="op">&gt;</span> ../nextflow_inputs/set_of_files_3.txt</span>
<span id="cb26-4"><a href="basic-features.html#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;This is content of file 4&quot;</span> <span class="op">&gt;</span> ../nextflow_inputs/set_of_files_4.txt</span>
<span id="cb26-5"><a href="basic-features.html#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;This is content of file 5&quot;</span> <span class="op">&gt;</span> ../nextflow_inputs/set_of_files_5.txt</span>
<span id="cb26-6"><a href="basic-features.html#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;This is content of file 6&quot;</span> <span class="op">&gt;</span> ../nextflow_inputs/set_of_files_6.txt</span>
<span id="cb26-7"><a href="basic-features.html#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;This is content of file 7&quot;</span> <span class="op">&gt;</span> ../nextflow_inputs/set_of_files_7.txt</span>
<span id="cb26-8"><a href="basic-features.html#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;This is content of file 8&quot;</span> <span class="op">&gt;</span> ../nextflow_inputs/set_of_files_8.txt</span></code></pre></div>
<p>Now we just need to modify <code>input_file</code> in <code>nextflow.config</code></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb27-1"><a href="basic-features.html#cb27-1" aria-hidden="true" tabindex="-1"></a>params <span class="op">{</span></span>
<span id="cb27-2"><a href="basic-features.html#cb27-2" aria-hidden="true" tabindex="-1"></a>  input_file <span class="op">=</span> <span class="st">&quot;../nextflow_inputs/set_of_files_*.txt&quot;</span></span>
<span id="cb27-3"><a href="basic-features.html#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>If you want to see how your <code>nextflow.config</code> should look like at this stage open this hidden section</p>
<details>
<summary>
Code
</summary>
<div class="sourceCode" id="cb28"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb28-1"><a href="basic-features.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">// you can also put comments in nextflow.config</span></span>
<span id="cb28-2"><a href="basic-features.html#cb28-2" aria-hidden="true" tabindex="-1"></a>workDir <span class="op">=</span> <span class="st">&quot;../nextflow_workdir&quot;</span></span>
<span id="cb28-3"><a href="basic-features.html#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="basic-features.html#cb28-4" aria-hidden="true" tabindex="-1"></a>params <span class="op">{</span></span>
<span id="cb28-5"><a href="basic-features.html#cb28-5" aria-hidden="true" tabindex="-1"></a>  input_file <span class="op">=</span> <span class="st">&quot;../nextflow_inputs/set_of_files_*.txt&quot;</span></span>
<span id="cb28-6"><a href="basic-features.html#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</details>
<p>Now run again the workflow with <code>nextflow run main.nf</code>.
This time if you examine the output folder with <code>ls ../nextflow_output/duplicate_lines</code> you will find a set of files</p>
<pre><code>a_file.duplicated.txt
set_of_files_1.duplicated.txt
set_of_files_2.duplicated.txt
set_of_files_3.duplicated.txt
set_of_files_4.duplicated.txt
set_of_files_5.duplicated.txt
set_of_files_6.duplicated.txt
set_of_files_7.duplicated.txt
set_of_files_8.duplicated.txt</code></pre>
<p>Like before, each of them will contain the duplicated version of the original files.</p>
<p>Let’s examine what happened:</p>
<ul>
<li>We changed <code>params.input_ch</code> to contain a glob pattern. This is expanded by Nextflow to yield a list of matching files.</li>
<li>The matching files are fed one by one via the channel <code>input_ch</code> to the process <code>duplicate_lines</code></li>
<li>The process <code>duplicate_lines</code> operates independently but in parallel on all the inputs, producing the output files. Each task is executed in its own private directory.</li>
</ul>
</div>
<div id="using-a-sample-sheet-and-value-channels" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Using a sample sheet and value channels<a href="basic-features.html#using-a-sample-sheet-and-value-channels" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Using glob patterns for specifying samples is useful and quick, but what if we want to specify input files that live in many different directories with very different names?
And if we want some files to be processed in pairs with other specific files, or with specific parameters?
For such use cases, a sample sheet is the easiest solution and it is the recommended way to specify workflow inputs.</p>
<p>A sample sheet is just a <a href="https://www.wikiwand.com/en/Comma-separated_values">CSV</a> file with one row per file to be processed, and with each column specifying either a file or a parameter.
Create a sample sheet called <code>../nextflow_inputs/samplesheet.csv</code> by running the following command.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="basic-features.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;sample,content&quot;</span> <span class="op">&gt;</span> ../nextflow_inputs/samplesheet.csv</span>
<span id="cb30-2"><a href="basic-features.html#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/../nextflow_inputs/set_of_files_1.txt,csv_content_1&quot;</span> <span class="op">&gt;&gt;</span> ../nextflow_inputs/samplesheet.csv</span>
<span id="cb30-3"><a href="basic-features.html#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/../nextflow_inputs/set_of_files_2.txt,csv_content_2&quot;</span> <span class="op">&gt;&gt;</span> ../nextflow_inputs/samplesheet.csv</span>
<span id="cb30-4"><a href="basic-features.html#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/../nextflow_inputs/set_of_files_3.txt,csv_content_3&quot;</span> <span class="op">&gt;&gt;</span> ../nextflow_inputs/samplesheet.csv</span>
<span id="cb30-5"><a href="basic-features.html#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/../nextflow_inputs/set_of_files_4.txt,csv_content_4&quot;</span> <span class="op">&gt;&gt;</span> ../nextflow_inputs/samplesheet.csv</span>
<span id="cb30-6"><a href="basic-features.html#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/../nextflow_inputs/set_of_files_5.txt,csv_content_5&quot;</span> <span class="op">&gt;&gt;</span> ../nextflow_inputs/samplesheet.csv</span>
<span id="cb30-7"><a href="basic-features.html#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/../nextflow_inputs/set_of_files_6.txt,csv_content_6&quot;</span> <span class="op">&gt;&gt;</span> ../nextflow_inputs/samplesheet.csv</span>
<span id="cb30-8"><a href="basic-features.html#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/../nextflow_inputs/set_of_files_7.txt,csv_content_7&quot;</span> <span class="op">&gt;&gt;</span> ../nextflow_inputs/samplesheet.csv</span>
<span id="cb30-9"><a href="basic-features.html#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/../nextflow_inputs/set_of_files_8.txt,csv_content_8&quot;</span> <span class="op">&gt;&gt;</span> ../nextflow_inputs/samplesheet.csv</span></code></pre></div>
<p>Now create a process called <code>append_to_file</code></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb31-1"><a href="basic-features.html#cb31-1" aria-hidden="true" tabindex="-1"></a>process append_to_file <span class="op">{</span></span>
<span id="cb31-2"><a href="basic-features.html#cb31-2" aria-hidden="true" tabindex="-1"></a>    publishDir <span class="st">&quot;../nextflow_output/append_to_file&quot;</span></span>
<span id="cb31-3"><a href="basic-features.html#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="basic-features.html#cb31-4" aria-hidden="true" tabindex="-1"></a>    input<span class="op">:</span></span>
<span id="cb31-5"><a href="basic-features.html#cb31-5" aria-hidden="true" tabindex="-1"></a>        path my_file</span>
<span id="cb31-6"><a href="basic-features.html#cb31-6" aria-hidden="true" tabindex="-1"></a>        val my_val</span>
<span id="cb31-7"><a href="basic-features.html#cb31-7" aria-hidden="true" tabindex="-1"></a>    output<span class="op">:</span></span>
<span id="cb31-8"><a href="basic-features.html#cb31-8" aria-hidden="true" tabindex="-1"></a>        path <span class="st">&quot;</span><span class="ss">${</span>my_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.appended.txt&quot;</span></span>
<span id="cb31-9"><a href="basic-features.html#cb31-9" aria-hidden="true" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb31-10"><a href="basic-features.html#cb31-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb31-11"><a href="basic-features.html#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="st">        cat </span><span class="ss">$my_file</span><span class="st"> &gt; </span><span class="ss">${</span>my_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.appended.txt</span></span>
<span id="cb31-12"><a href="basic-features.html#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="st">        echo &quot;</span><span class="ss">$my_val</span><span class="st">&quot; &gt;&gt; </span><span class="ss">${</span>my_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.appended.txt</span></span>
<span id="cb31-13"><a href="basic-features.html#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb31-14"><a href="basic-features.html#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>And modify the workflow as follows</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb32-1"><a href="basic-features.html#cb32-1" aria-hidden="true" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb32-2"><a href="basic-features.html#cb32-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span> params<span class="op">.</span>samplesheet <span class="op">)</span></span>
<span id="cb32-3"><a href="basic-features.html#cb32-3" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">splitCsv</span><span class="op">(</span> header<span class="op">:</span> <span class="kw">true</span> <span class="op">)</span></span>
<span id="cb32-4"><a href="basic-features.html#cb32-4" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">set</span><span class="op">{</span> input_ch <span class="op">}</span></span>
<span id="cb32-5"><a href="basic-features.html#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="basic-features.html#cb32-6" aria-hidden="true" tabindex="-1"></a>    input_ch<span class="op">.</span><span class="fu">map</span><span class="op">{</span> it<span class="op">[</span><span class="st">&quot;sample&quot;</span><span class="op">]</span> <span class="op">}.</span><span class="fu">set</span><span class="op">{</span> sample_ch <span class="op">}</span></span>
<span id="cb32-7"><a href="basic-features.html#cb32-7" aria-hidden="true" tabindex="-1"></a>    input_ch<span class="op">.</span><span class="fu">map</span><span class="op">{</span> it<span class="op">[</span><span class="st">&quot;content&quot;</span><span class="op">]</span> <span class="op">}.</span><span class="fu">set</span><span class="op">{</span> content_ch <span class="op">}</span></span>
<span id="cb32-8"><a href="basic-features.html#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="basic-features.html#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">duplicate_lines</span><span class="op">(</span> sample_ch <span class="op">)</span></span>
<span id="cb32-10"><a href="basic-features.html#cb32-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">append_to_file</span><span class="op">(</span> duplicate_lines<span class="op">.</span>out<span class="op">,</span> content_ch <span class="op">)</span></span>
<span id="cb32-11"><a href="basic-features.html#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>If you want to see how your <code>main.nf</code> file should look like at this stage open this hidden section</p>
<details>
<summary>
Code
</summary>
<div class="sourceCode" id="cb33"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb33-1"><a href="basic-features.html#cb33-1" aria-hidden="true" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb33-2"><a href="basic-features.html#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="basic-features.html#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co">// this is a comment</span></span>
<span id="cb33-4"><a href="basic-features.html#cb33-4" aria-hidden="true" tabindex="-1"></a>process say_hello <span class="op">{</span></span>
<span id="cb33-5"><a href="basic-features.html#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// comments can be written anywhere</span></span>
<span id="cb33-6"><a href="basic-features.html#cb33-6" aria-hidden="true" tabindex="-1"></a>    output<span class="op">:</span></span>
<span id="cb33-7"><a href="basic-features.html#cb33-7" aria-hidden="true" tabindex="-1"></a>        path <span class="st">&quot;hello_world.txt&quot;</span></span>
<span id="cb33-8"><a href="basic-features.html#cb33-8" aria-hidden="true" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb33-9"><a href="basic-features.html#cb33-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb33-10"><a href="basic-features.html#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="st">        echo &quot;This is the EBI predoc course&quot; &gt; hello_world.txt</span></span>
<span id="cb33-11"><a href="basic-features.html#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb33-12"><a href="basic-features.html#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb33-13"><a href="basic-features.html#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="basic-features.html#cb33-14" aria-hidden="true" tabindex="-1"></a>process duplicate_lines <span class="op">{</span></span>
<span id="cb33-15"><a href="basic-features.html#cb33-15" aria-hidden="true" tabindex="-1"></a>    publishDir <span class="st">&quot;../nextflow_output/duplicate_lines&quot;</span></span>
<span id="cb33-16"><a href="basic-features.html#cb33-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-17"><a href="basic-features.html#cb33-17" aria-hidden="true" tabindex="-1"></a>    input<span class="op">:</span></span>
<span id="cb33-18"><a href="basic-features.html#cb33-18" aria-hidden="true" tabindex="-1"></a>        path my_file</span>
<span id="cb33-19"><a href="basic-features.html#cb33-19" aria-hidden="true" tabindex="-1"></a>    output<span class="op">:</span></span>
<span id="cb33-20"><a href="basic-features.html#cb33-20" aria-hidden="true" tabindex="-1"></a>        path <span class="st">&quot;</span><span class="ss">${</span>my_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.duplicated.txt&quot;</span></span>
<span id="cb33-21"><a href="basic-features.html#cb33-21" aria-hidden="true" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb33-22"><a href="basic-features.html#cb33-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb33-23"><a href="basic-features.html#cb33-23" aria-hidden="true" tabindex="-1"></a><span class="st">        cat </span><span class="ss">$my_file</span><span class="st"> </span><span class="ss">$my_file</span><span class="st"> &gt; </span><span class="ss">${</span>my_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.duplicated.txt</span></span>
<span id="cb33-24"><a href="basic-features.html#cb33-24" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb33-25"><a href="basic-features.html#cb33-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb33-26"><a href="basic-features.html#cb33-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-27"><a href="basic-features.html#cb33-27" aria-hidden="true" tabindex="-1"></a>process append_to_file <span class="op">{</span></span>
<span id="cb33-28"><a href="basic-features.html#cb33-28" aria-hidden="true" tabindex="-1"></a>    publishDir <span class="st">&quot;../nextflow_output/append_to_file&quot;</span></span>
<span id="cb33-29"><a href="basic-features.html#cb33-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-30"><a href="basic-features.html#cb33-30" aria-hidden="true" tabindex="-1"></a>    input<span class="op">:</span></span>
<span id="cb33-31"><a href="basic-features.html#cb33-31" aria-hidden="true" tabindex="-1"></a>        path my_file</span>
<span id="cb33-32"><a href="basic-features.html#cb33-32" aria-hidden="true" tabindex="-1"></a>        val my_val</span>
<span id="cb33-33"><a href="basic-features.html#cb33-33" aria-hidden="true" tabindex="-1"></a>    output<span class="op">:</span></span>
<span id="cb33-34"><a href="basic-features.html#cb33-34" aria-hidden="true" tabindex="-1"></a>        path <span class="st">&quot;</span><span class="ss">${</span>my_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.appended.txt&quot;</span></span>
<span id="cb33-35"><a href="basic-features.html#cb33-35" aria-hidden="true" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb33-36"><a href="basic-features.html#cb33-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb33-37"><a href="basic-features.html#cb33-37" aria-hidden="true" tabindex="-1"></a><span class="st">        cat </span><span class="ss">$my_file</span><span class="st"> &gt; </span><span class="ss">${</span>my_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.appended.txt</span></span>
<span id="cb33-38"><a href="basic-features.html#cb33-38" aria-hidden="true" tabindex="-1"></a><span class="st">        echo &quot;</span><span class="ss">$my_val</span><span class="st">&quot; &gt;&gt; </span><span class="ss">${</span>my_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.appended.txt</span></span>
<span id="cb33-39"><a href="basic-features.html#cb33-39" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb33-40"><a href="basic-features.html#cb33-40" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb33-41"><a href="basic-features.html#cb33-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-42"><a href="basic-features.html#cb33-42" aria-hidden="true" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb33-43"><a href="basic-features.html#cb33-43" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span> params<span class="op">.</span>samplesheet <span class="op">)</span></span>
<span id="cb33-44"><a href="basic-features.html#cb33-44" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">splitCsv</span><span class="op">(</span> header<span class="op">:</span> <span class="kw">true</span> <span class="op">)</span></span>
<span id="cb33-45"><a href="basic-features.html#cb33-45" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">set</span><span class="op">{</span> input_ch <span class="op">}</span></span>
<span id="cb33-46"><a href="basic-features.html#cb33-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-47"><a href="basic-features.html#cb33-47" aria-hidden="true" tabindex="-1"></a>    input_ch<span class="op">.</span><span class="fu">map</span><span class="op">{</span> it<span class="op">[</span><span class="st">&quot;sample&quot;</span><span class="op">]</span> <span class="op">}.</span><span class="fu">set</span><span class="op">{</span> sample_ch <span class="op">}</span></span>
<span id="cb33-48"><a href="basic-features.html#cb33-48" aria-hidden="true" tabindex="-1"></a>    input_ch<span class="op">.</span><span class="fu">map</span><span class="op">{</span> it<span class="op">[</span><span class="st">&quot;content&quot;</span><span class="op">]</span> <span class="op">}.</span><span class="fu">set</span><span class="op">{</span> content_ch <span class="op">}</span></span>
<span id="cb33-49"><a href="basic-features.html#cb33-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-50"><a href="basic-features.html#cb33-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">duplicate_lines</span><span class="op">(</span> sample_ch <span class="op">)</span></span>
<span id="cb33-51"><a href="basic-features.html#cb33-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">append_to_file</span><span class="op">(</span> duplicate_lines<span class="op">.</span>out<span class="op">,</span> content_ch <span class="op">)</span></span>
<span id="cb33-52"><a href="basic-features.html#cb33-52" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</details>
<p>Now we need to modify the <code>params</code> block in your <code>nextflow.config</code></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb34-1"><a href="basic-features.html#cb34-1" aria-hidden="true" tabindex="-1"></a>params <span class="op">{</span></span>
<span id="cb34-2"><a href="basic-features.html#cb34-2" aria-hidden="true" tabindex="-1"></a>  samplesheet <span class="op">=</span> <span class="st">&quot;../nextflow_inputs/samplesheet.csv&quot;</span></span>
<span id="cb34-3"><a href="basic-features.html#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>If you want to see how your <code>nextflow.config</code> should look like at this stage open this hidden section</p>
<details>
<summary>
Code
</summary>
<div class="sourceCode" id="cb35"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb35-1"><a href="basic-features.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">// you can also put comments in nextflow.config</span></span>
<span id="cb35-2"><a href="basic-features.html#cb35-2" aria-hidden="true" tabindex="-1"></a>workDir <span class="op">=</span> <span class="st">&quot;../nextflow_workdir&quot;</span></span>
<span id="cb35-3"><a href="basic-features.html#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="basic-features.html#cb35-4" aria-hidden="true" tabindex="-1"></a>params <span class="op">{</span></span>
<span id="cb35-5"><a href="basic-features.html#cb35-5" aria-hidden="true" tabindex="-1"></a>  samplesheet <span class="op">=</span> <span class="st">&quot;../nextflow_inputs/samplesheet.csv&quot;</span></span>
<span id="cb35-6"><a href="basic-features.html#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</details>
<p>Now run again the workflow with <code>nextflow run main.nf</code>.
This time if you examine the output folder with <code>ls ../nextflow_output/append_to_file</code> you will find a set of files</p>
<pre><code>set_of_files_1.append_to_file.txt
set_of_files_2.append_to_file.txt
set_of_files_3.append_to_file.txt
set_of_files_4.append_to_file.txt
set_of_files_5.append_to_file.txt
set_of_files_6.append_to_file.txt
set_of_files_7.append_to_file.txt
set_of_files_8.append_to_file.txt</code></pre>
<p>Taking as an example the first one, <code>set_of_files_1.append_to_file.txt</code> we would expect it to contain</p>
<pre><code>This is content of file 1
This is content of file 1
csv_content_1</code></pre>
<p>However, most probably it will contain something like</p>
<pre><code>This is content of file 1
This is content of file 1
csv_content_3</code></pre>
<p>So the first two lines have the correct number but the last line shows the wrong element! What’s more, the element shown on the last line can be different on each run (try!). We said before that channels are guaranteed to emit elements in the same order that they are received, so we should have the correct matches between files and values. What happened?</p>
<p>What happened is that channels are indeed guaranteed to preserve order, but processes and some operators are not because of their asynchronous and parallel nature. In our case, the process <code>duplicate_lines</code> receives the files in the correct order, but it is not guaranteed to emit them in the same order. This is because all the files are processed in parallel.
So for example, <code>set_of_files_5.append_to_file.txt</code> could be processed and emitted some milliseconds earlier than <code>set_of_files_1.append_to_file.txt</code>, altering the order.</p>
<p>A better approach when we want multiple channels to be used by one process with some predictable matching is to join channels using matching keys.
We will explore it in the next section.
For now, let’s examine what happened in this version of our workflow:</p>
<ul>
<li>We created the process <code>append_to_file</code>, which takes in input a file (<code>path my_file</code>) and a value (<code>val my_val</code>). This process copies the content of <code>my_file</code> to <code>${my_file.simpleName}.append_to_file.txt</code> and then appends to the newly created file the content of <code>my_val</code></li>
<li>We defined the parameter <code>samplesheet</code> in <code>nextflow.config</code></li>
<li>We modified the workflow so that we use <code>params.samplesheet</code> to create a channel with the channel factory <code>Channel.fromPath</code></li>
<li>We applied the operator <code>splitCsv</code> to this channel containing the sample sheet, using the option <code>header: true</code>. This operator reads the file contained in the channel assuming it to be a CSV file with a header line. Then it produces in output another channel containing, for each row in the sample sheet, a groovy map (what in Python would be called a <a href="https://en.wikibooks.org/wiki/A-level_Computing/AQA/Paper_1/Fundamentals_of_data_structures/Dictionaries">dictionary</a>). This map contains a key for each element in the CSV header, and a value corresponding to the value of that column in the current line of the CSV file.</li>
<li>We apply the <code>map</code> operator (<code>map{ it["sample"] }</code>) to the resulting channel
<ul>
<li>The map operator is follwed by a <a href="https://www.wikiwand.com/en/Closure_(computer_programming)">closure</a> (<code>{ it["sample"] }</code>)</li>
<li>You can think of a closure as an unnamed function (like a lambda function in Python)</li>
<li>The <code>map</code> operator calls this unnamed function for each element in the channel and creates another channel containing the respective function outputs</li>
<li>Closures understand the implicit variable <code>it</code>, which represents whatever input is given to the function</li>
<li>If an explicit return statement is not present in the closure, the last evaluated expression is returned by the closure ( <code>it["sample"]</code> in this case)</li>
</ul></li>
<li>Since <code>splitCsv</code> created a dictionary for each item in the sample sheet, <code>map{ it["sample"] }</code> replaces that dictionary (<code>it</code> in the closure) with the content of the value contained in it under the key <code>"sample"</code></li>
<li><code>input_ch</code> is used again in <code>input_ch.map{ it["content"] }.set{ content_ch }</code> to extract the value of the column <code>content</code> for each sample in the sample sheet
<ul>
<li>Channels can be used many times, and each time all the files contained in them are processed. So both <code>input_ch.map{ it["content"] }.set{ content_ch }</code> and <code>input_ch.map{ it["sample"] }.set{ sample_ch }</code> process every element in <code>input_ch</code></li>
</ul></li>
<li>We created the channels <code>sample_ch</code> and <code>content_ch</code> using the <code>set</code> operator. They contain respectively the sample files and the <code>content</code> values related to them.
<ul>
<li>The order of processing in a channel is guaranteed, so we can be sure that each sample will be paired with the correct <code>content</code> value</li>
</ul></li>
<li>We fed the channel <code>sample_ch</code> to the process <code>duplicate_lines</code>, and we fed the output of the process <code>duplicate_lines</code> to the process <code>append_to_file</code> together with the values in the channel <code>content_ch</code>
<ul>
<li>This is the step that messed up the pairing of the channels, since the process <code>duplicate_lines</code> is not guaranteed to produce in output elements in the same order in which it receives them in input</li>
</ul></li>
<li><code>append_to_file</code> appended the value of <code>content_ch</code> to the output of <code>duplicate_lines</code>, creating the final result</li>
</ul>
<p>Note that we introduced a new qualifier: <code>val</code>. The <code>val</code> qualifier specifies a value, differently from the <code>path</code> qualifier that specifies a file. If I write an expression like <code>val variable_name</code>, then the variable <code>variable_name</code> can contain something like a string or a number, depending on what is fed to the process input.
It is also possible to manually create value channels using the channel factory <code>Channel.value</code>.
Take as an example the following</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb39-1"><a href="basic-features.html#cb39-1" aria-hidden="true" tabindex="-1"></a>workflow<span class="op">{</span></span>
<span id="cb39-2"><a href="basic-features.html#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">Channel</span><span class="op">.</span><span class="fu">value</span><span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">).</span><span class="fu">view</span><span class="op">()</span></span>
<span id="cb39-3"><a href="basic-features.html#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>This would produce a channel containing in order the values 1, 2, and 3. These would then be printed one by one to the terminal by the view operator.</p>
</div>
<div id="the-tuple-input-qualifier-and-joining-channels" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> The <code>tuple</code> input qualifier and joining channels<a href="basic-features.html#the-tuple-input-qualifier-and-joining-channels" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the previous section, we saw how processes are not guaranteed to emit outputs in the same order in which inputs are received.
This caused unexpected input pairs to occur in downstream processes of our workflow.
Here we will see how we can enforce the correct pairing of different channels by joining them using matching keys.
We will also introduce the <code>tuple</code> input qualifier.</p>
<p>Let’s first create a sample sheet very similar to the one we used before, but with the added column <code>id</code> to uniquely identify each line.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb40-1"><a href="basic-features.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;id,sample,content&quot;</span> <span class="op">&gt;</span> ../nextflow_inputs/samplesheet.csv</span>
<span id="cb40-2"><a href="basic-features.html#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;1,</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/../nextflow_inputs/set_of_files_1.txt,csv_content_1&quot;</span> <span class="op">&gt;&gt;</span> ../nextflow_inputs/samplesheet.csv</span>
<span id="cb40-3"><a href="basic-features.html#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;2,</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/../nextflow_inputs/set_of_files_2.txt,csv_content_2&quot;</span> <span class="op">&gt;&gt;</span> ../nextflow_inputs/samplesheet.csv</span>
<span id="cb40-4"><a href="basic-features.html#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;3,</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/../nextflow_inputs/set_of_files_3.txt,csv_content_3&quot;</span> <span class="op">&gt;&gt;</span> ../nextflow_inputs/samplesheet.csv</span>
<span id="cb40-5"><a href="basic-features.html#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;4,</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/../nextflow_inputs/set_of_files_4.txt,csv_content_4&quot;</span> <span class="op">&gt;&gt;</span> ../nextflow_inputs/samplesheet.csv</span>
<span id="cb40-6"><a href="basic-features.html#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;5,</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/../nextflow_inputs/set_of_files_5.txt,csv_content_5&quot;</span> <span class="op">&gt;&gt;</span> ../nextflow_inputs/samplesheet.csv</span>
<span id="cb40-7"><a href="basic-features.html#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;6,</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/../nextflow_inputs/set_of_files_6.txt,csv_content_6&quot;</span> <span class="op">&gt;&gt;</span> ../nextflow_inputs/samplesheet.csv</span>
<span id="cb40-8"><a href="basic-features.html#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;7,</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/../nextflow_inputs/set_of_files_7.txt,csv_content_7&quot;</span> <span class="op">&gt;&gt;</span> ../nextflow_inputs/samplesheet.csv</span>
<span id="cb40-9"><a href="basic-features.html#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;8,</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">/../nextflow_inputs/set_of_files_8.txt,csv_content_8&quot;</span> <span class="op">&gt;&gt;</span> ../nextflow_inputs/samplesheet.csv</span></code></pre></div>
<p>Let’s now modify the workflow definition as follows</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb41-1"><a href="basic-features.html#cb41-1" aria-hidden="true" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb41-2"><a href="basic-features.html#cb41-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span> params<span class="op">.</span>samplesheet <span class="op">)</span></span>
<span id="cb41-3"><a href="basic-features.html#cb41-3" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">splitCsv</span><span class="op">(</span> header<span class="op">:</span> <span class="kw">true</span> <span class="op">)</span></span>
<span id="cb41-4"><a href="basic-features.html#cb41-4" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">set</span><span class="op">{</span> input_ch <span class="op">}</span></span>
<span id="cb41-5"><a href="basic-features.html#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="basic-features.html#cb41-6" aria-hidden="true" tabindex="-1"></a>    input_ch<span class="op">.</span><span class="fu">map</span><span class="op">{</span> <span class="op">[</span> it<span class="op">[</span><span class="st">&quot;id&quot;</span><span class="op">],</span> it<span class="op">[</span><span class="st">&quot;sample&quot;</span><span class="op">]</span> <span class="op">]</span> <span class="op">}.</span><span class="fu">set</span><span class="op">{</span> sample_ch <span class="op">}</span></span>
<span id="cb41-7"><a href="basic-features.html#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="basic-features.html#cb41-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">duplicate_lines</span><span class="op">(</span> sample_ch <span class="op">)</span></span>
<span id="cb41-9"><a href="basic-features.html#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="basic-features.html#cb41-10" aria-hidden="true" tabindex="-1"></a>    input_ch<span class="op">.</span><span class="fu">map</span><span class="op">{</span> <span class="op">[</span> it<span class="op">[</span><span class="st">&quot;id&quot;</span><span class="op">],</span> it<span class="op">[</span><span class="st">&quot;content&quot;</span><span class="op">]</span> <span class="op">]</span> <span class="op">}</span></span>
<span id="cb41-11"><a href="basic-features.html#cb41-11" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">join</span><span class="op">(</span>duplicate_lines<span class="op">.</span>out<span class="op">,</span> by<span class="op">:</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb41-12"><a href="basic-features.html#cb41-12" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">set</span><span class="op">{</span> append_to_file_in_ch <span class="op">}</span></span>
<span id="cb41-13"><a href="basic-features.html#cb41-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-14"><a href="basic-features.html#cb41-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">append_to_file</span><span class="op">(</span> append_to_file_in_ch <span class="op">)</span></span>
<span id="cb41-15"><a href="basic-features.html#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>And let’s modify the definition of the processes <code>duplicate_lines</code> and <code>append_to_file</code> as follows</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb42-1"><a href="basic-features.html#cb42-1" aria-hidden="true" tabindex="-1"></a>process duplicate_lines <span class="op">{</span></span>
<span id="cb42-2"><a href="basic-features.html#cb42-2" aria-hidden="true" tabindex="-1"></a>    publishDir <span class="st">&quot;../nextflow_output/duplicate_lines&quot;</span></span>
<span id="cb42-3"><a href="basic-features.html#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="basic-features.html#cb42-4" aria-hidden="true" tabindex="-1"></a>    input<span class="op">:</span></span>
<span id="cb42-5"><a href="basic-features.html#cb42-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tuple</span><span class="op">(</span></span>
<span id="cb42-6"><a href="basic-features.html#cb42-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">val</span><span class="op">(</span>id<span class="op">),</span></span>
<span id="cb42-7"><a href="basic-features.html#cb42-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">path</span><span class="op">(</span>my_file<span class="op">)</span></span>
<span id="cb42-8"><a href="basic-features.html#cb42-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">)</span></span>
<span id="cb42-9"><a href="basic-features.html#cb42-9" aria-hidden="true" tabindex="-1"></a>    output<span class="op">:</span></span>
<span id="cb42-10"><a href="basic-features.html#cb42-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tuple</span><span class="op">(</span></span>
<span id="cb42-11"><a href="basic-features.html#cb42-11" aria-hidden="true" tabindex="-1"></a>          <span class="fu">val</span><span class="op">(</span>id<span class="op">),</span></span>
<span id="cb42-12"><a href="basic-features.html#cb42-12" aria-hidden="true" tabindex="-1"></a>          <span class="fu">path</span><span class="op">(</span><span class="st">&quot;</span><span class="ss">${</span>my_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.duplicated.txt&quot;</span><span class="op">)</span></span>
<span id="cb42-13"><a href="basic-features.html#cb42-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">)</span></span>
<span id="cb42-14"><a href="basic-features.html#cb42-14" aria-hidden="true" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb42-15"><a href="basic-features.html#cb42-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb42-16"><a href="basic-features.html#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="st">        cat </span><span class="ss">$my_file</span><span class="st"> </span><span class="ss">$my_file</span><span class="st"> &gt; </span><span class="ss">${</span>my_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.duplicated.txt</span></span>
<span id="cb42-17"><a href="basic-features.html#cb42-17" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb42-18"><a href="basic-features.html#cb42-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb42-19"><a href="basic-features.html#cb42-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-20"><a href="basic-features.html#cb42-20" aria-hidden="true" tabindex="-1"></a>process append_to_file <span class="op">{</span></span>
<span id="cb42-21"><a href="basic-features.html#cb42-21" aria-hidden="true" tabindex="-1"></a>    publishDir <span class="st">&quot;../nextflow_output/append_to_file&quot;</span></span>
<span id="cb42-22"><a href="basic-features.html#cb42-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-23"><a href="basic-features.html#cb42-23" aria-hidden="true" tabindex="-1"></a>    input<span class="op">:</span></span>
<span id="cb42-24"><a href="basic-features.html#cb42-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tuple</span><span class="op">(</span></span>
<span id="cb42-25"><a href="basic-features.html#cb42-25" aria-hidden="true" tabindex="-1"></a>            <span class="fu">val</span><span class="op">(</span>id<span class="op">),</span></span>
<span id="cb42-26"><a href="basic-features.html#cb42-26" aria-hidden="true" tabindex="-1"></a>            <span class="fu">val</span><span class="op">(</span>my_val<span class="op">),</span></span>
<span id="cb42-27"><a href="basic-features.html#cb42-27" aria-hidden="true" tabindex="-1"></a>            <span class="fu">path</span><span class="op">(</span>my_file<span class="op">)</span></span>
<span id="cb42-28"><a href="basic-features.html#cb42-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">)</span></span>
<span id="cb42-29"><a href="basic-features.html#cb42-29" aria-hidden="true" tabindex="-1"></a>    output<span class="op">:</span></span>
<span id="cb42-30"><a href="basic-features.html#cb42-30" aria-hidden="true" tabindex="-1"></a>        path <span class="st">&quot;</span><span class="ss">${</span>my_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.appended.txt&quot;</span></span>
<span id="cb42-31"><a href="basic-features.html#cb42-31" aria-hidden="true" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb42-32"><a href="basic-features.html#cb42-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb42-33"><a href="basic-features.html#cb42-33" aria-hidden="true" tabindex="-1"></a><span class="st">        cat </span><span class="ss">$my_file</span><span class="st"> &gt; </span><span class="ss">${</span>my_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.appended.txt</span></span>
<span id="cb42-34"><a href="basic-features.html#cb42-34" aria-hidden="true" tabindex="-1"></a><span class="st">        echo &quot;</span><span class="ss">$my_val</span><span class="st">&quot; &gt;&gt; </span><span class="ss">${</span>my_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.appended.txt</span></span>
<span id="cb42-35"><a href="basic-features.html#cb42-35" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb42-36"><a href="basic-features.html#cb42-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>If you want to see how your <code>main.nf</code> file should look like at this stage open this hidden section</p>
<details>
<summary>
Code
</summary>
<div class="sourceCode" id="cb43"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb43-1"><a href="basic-features.html#cb43-1" aria-hidden="true" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb43-2"><a href="basic-features.html#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="basic-features.html#cb43-3" aria-hidden="true" tabindex="-1"></a>process duplicate_lines <span class="op">{</span></span>
<span id="cb43-4"><a href="basic-features.html#cb43-4" aria-hidden="true" tabindex="-1"></a>    publishDir <span class="st">&quot;../nextflow_output/duplicate_lines&quot;</span></span>
<span id="cb43-5"><a href="basic-features.html#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="basic-features.html#cb43-6" aria-hidden="true" tabindex="-1"></a>    input<span class="op">:</span></span>
<span id="cb43-7"><a href="basic-features.html#cb43-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tuple</span><span class="op">(</span></span>
<span id="cb43-8"><a href="basic-features.html#cb43-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">val</span><span class="op">(</span>id<span class="op">),</span></span>
<span id="cb43-9"><a href="basic-features.html#cb43-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">path</span><span class="op">(</span>my_file<span class="op">)</span></span>
<span id="cb43-10"><a href="basic-features.html#cb43-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">)</span></span>
<span id="cb43-11"><a href="basic-features.html#cb43-11" aria-hidden="true" tabindex="-1"></a>    output<span class="op">:</span></span>
<span id="cb43-12"><a href="basic-features.html#cb43-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tuple</span><span class="op">(</span></span>
<span id="cb43-13"><a href="basic-features.html#cb43-13" aria-hidden="true" tabindex="-1"></a>          <span class="fu">val</span><span class="op">(</span>id<span class="op">),</span></span>
<span id="cb43-14"><a href="basic-features.html#cb43-14" aria-hidden="true" tabindex="-1"></a>          <span class="fu">path</span><span class="op">(</span><span class="st">&quot;</span><span class="ss">${</span>my_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.duplicated.txt&quot;</span><span class="op">)</span></span>
<span id="cb43-15"><a href="basic-features.html#cb43-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">)</span></span>
<span id="cb43-16"><a href="basic-features.html#cb43-16" aria-hidden="true" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb43-17"><a href="basic-features.html#cb43-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb43-18"><a href="basic-features.html#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="st">        cat </span><span class="ss">$my_file</span><span class="st"> </span><span class="ss">$my_file</span><span class="st"> &gt; </span><span class="ss">${</span>my_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.duplicated.txt</span></span>
<span id="cb43-19"><a href="basic-features.html#cb43-19" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb43-20"><a href="basic-features.html#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-21"><a href="basic-features.html#cb43-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-22"><a href="basic-features.html#cb43-22" aria-hidden="true" tabindex="-1"></a>process append_to_file <span class="op">{</span></span>
<span id="cb43-23"><a href="basic-features.html#cb43-23" aria-hidden="true" tabindex="-1"></a>    publishDir <span class="st">&quot;../nextflow_output/append_to_file&quot;</span></span>
<span id="cb43-24"><a href="basic-features.html#cb43-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-25"><a href="basic-features.html#cb43-25" aria-hidden="true" tabindex="-1"></a>    input<span class="op">:</span></span>
<span id="cb43-26"><a href="basic-features.html#cb43-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tuple</span><span class="op">(</span></span>
<span id="cb43-27"><a href="basic-features.html#cb43-27" aria-hidden="true" tabindex="-1"></a>            <span class="fu">val</span><span class="op">(</span>id<span class="op">),</span></span>
<span id="cb43-28"><a href="basic-features.html#cb43-28" aria-hidden="true" tabindex="-1"></a>            <span class="fu">val</span><span class="op">(</span>my_val<span class="op">),</span></span>
<span id="cb43-29"><a href="basic-features.html#cb43-29" aria-hidden="true" tabindex="-1"></a>            <span class="fu">path</span><span class="op">(</span>my_file<span class="op">)</span></span>
<span id="cb43-30"><a href="basic-features.html#cb43-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">)</span></span>
<span id="cb43-31"><a href="basic-features.html#cb43-31" aria-hidden="true" tabindex="-1"></a>    output<span class="op">:</span></span>
<span id="cb43-32"><a href="basic-features.html#cb43-32" aria-hidden="true" tabindex="-1"></a>        path <span class="st">&quot;</span><span class="ss">${</span>my_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.appended.txt&quot;</span></span>
<span id="cb43-33"><a href="basic-features.html#cb43-33" aria-hidden="true" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb43-34"><a href="basic-features.html#cb43-34" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb43-35"><a href="basic-features.html#cb43-35" aria-hidden="true" tabindex="-1"></a><span class="st">        cat </span><span class="ss">$my_file</span><span class="st"> &gt; </span><span class="ss">${</span>my_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.appended.txt</span></span>
<span id="cb43-36"><a href="basic-features.html#cb43-36" aria-hidden="true" tabindex="-1"></a><span class="st">        echo &quot;</span><span class="ss">$my_val</span><span class="st">&quot; &gt;&gt; </span><span class="ss">${</span>my_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.appended.txt</span></span>
<span id="cb43-37"><a href="basic-features.html#cb43-37" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb43-38"><a href="basic-features.html#cb43-38" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-39"><a href="basic-features.html#cb43-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-40"><a href="basic-features.html#cb43-40" aria-hidden="true" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb43-41"><a href="basic-features.html#cb43-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span> params<span class="op">.</span>samplesheet <span class="op">)</span></span>
<span id="cb43-42"><a href="basic-features.html#cb43-42" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">splitCsv</span><span class="op">(</span> header<span class="op">:</span> <span class="kw">true</span> <span class="op">)</span></span>
<span id="cb43-43"><a href="basic-features.html#cb43-43" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">set</span><span class="op">{</span> input_ch <span class="op">}</span></span>
<span id="cb43-44"><a href="basic-features.html#cb43-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-45"><a href="basic-features.html#cb43-45" aria-hidden="true" tabindex="-1"></a>    input_ch<span class="op">.</span><span class="fu">map</span><span class="op">{</span> <span class="op">[</span> it<span class="op">[</span><span class="st">&quot;id&quot;</span><span class="op">],</span> it<span class="op">[</span><span class="st">&quot;sample&quot;</span><span class="op">]</span> <span class="op">]</span> <span class="op">}.</span><span class="fu">set</span><span class="op">{</span> sample_ch <span class="op">}</span></span>
<span id="cb43-46"><a href="basic-features.html#cb43-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-47"><a href="basic-features.html#cb43-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">duplicate_lines</span><span class="op">(</span> sample_ch <span class="op">)</span></span>
<span id="cb43-48"><a href="basic-features.html#cb43-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-49"><a href="basic-features.html#cb43-49" aria-hidden="true" tabindex="-1"></a>    input_ch<span class="op">.</span><span class="fu">map</span><span class="op">{</span> <span class="op">[</span> it<span class="op">[</span><span class="st">&quot;id&quot;</span><span class="op">],</span> it<span class="op">[</span><span class="st">&quot;content&quot;</span><span class="op">]</span> <span class="op">]</span> <span class="op">}</span></span>
<span id="cb43-50"><a href="basic-features.html#cb43-50" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">join</span><span class="op">(</span>duplicate_lines<span class="op">.</span>out<span class="op">,</span> by<span class="op">:</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb43-51"><a href="basic-features.html#cb43-51" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">set</span><span class="op">{</span> append_to_file_in_ch <span class="op">}</span></span>
<span id="cb43-52"><a href="basic-features.html#cb43-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-53"><a href="basic-features.html#cb43-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">append_to_file</span><span class="op">(</span> append_to_file_in_ch <span class="op">)</span></span>
<span id="cb43-54"><a href="basic-features.html#cb43-54" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</details>
<p>Now run again the workflow with <code>nextflow run main.nf</code>.
As before, if you examine the output folder with <code>ls ../nextflow_output/append_to_file</code> you will find a set of files</p>
<pre><code>set_of_files_1.append_to_file.txt
set_of_files_2.append_to_file.txt
set_of_files_3.append_to_file.txt
set_of_files_4.append_to_file.txt
set_of_files_5.append_to_file.txt
set_of_files_6.append_to_file.txt
set_of_files_7.append_to_file.txt
set_of_files_8.append_to_file.txt</code></pre>
<p>This time, if you check their content you will see that the last line is correctly paired with the first two.
Here, as an example, the content of the file <code>set_of_files_1.append_to_file.txt</code> is shown.</p>
<pre><code>This is content of file 1
This is content of file 1
csv_content_1</code></pre>
<p>Let’s examine how we achieved this result:</p>
<ul>
<li>We modified the sample sheet so to include a unique ID for each line</li>
<li>We modified all the processes to expect in input not a single element but tuples of two or three elements in a single channel
<ul>
<li>A <a href="https://www.wikiwand.com/en/Tuple">tuple</a> is the non-modifiable equivalent of a list</li>
<li>When a channel emits lists of elements, the input qualifier <code>tuple</code> should be used</li>
<li>The input qualifiers in the process definition for the tuple elements must match the order and cardinality of the lists emitted by the channel used as input for the process</li>
</ul></li>
<li>The input channel for the process <code>duplicate_lines</code> was modified so as to emit lists of two elements: the content of the <code>id</code> column and the content of the <code>sample</code> column (<code>input_ch.map{ [ it["id"], it["sample"] ] }</code>)</li>
<li>For the process <code>duplicate_lines</code>, the input block has been modified to expect tuples of two elements
<ul>
<li>The first element is expected to be of type <code>val</code> and it is not used in the process (but it is passed in the output unchanged)</li>
<li>The second element is expected to be of type <code>path</code> and will contain the file to be duplicated</li>
</ul></li>
<li>The output of the process <code>duplicate_lines</code> has also been modified to be of type <code>tuple</code>
<ul>
<li>This tuple produced in output will contain a first element of type <code>val</code>, consisting of the same <code>id</code> variable received as input</li>
<li>The second element of the tuple is the output file produced by the process, with a qualifier of type <code>path</code></li>
</ul></li>
<li>The <code>map</code> operator is used again of the the channel <code>input_ch</code> to extract the content of the columns <code>id</code> and <code>content</code>, as lists of two elements (<code>input_ch.map{ [ it["id"], it["content"] ] }</code>)</li>
<li>The channel operator <code>join</code> is used to join together the output of the process <code>duplicate_lines</code> with the channel resulting from the previous operation (<code>join(duplicate_lines.out, by: 0)</code>)
<ul>
<li>The <code>join</code> operator joins two or more channels together using a matching key, whose position is specified with the <code>by</code> keyword</li>
<li>In our case, we used <code>by: 0</code> as an argument to the <code>join</code> operator, meaning that we want to match the keys in the first position in the respective channels</li>
<li>The items of the two channels are matched in such a way that items with the same value in the first element of the lists (corresponding to the content of the column <code>id</code> of the sample sheet in both cases) are joined together</li>
<li>The resulting channel after the joining operation contains lists of three elements: the matching key itself, the remainder of the list emitted by the first channel after removal of the matching key (one element), and finally the remainder of the list emitted by the second channel after removal of the matching key (one element)</li>
<li>The resulting channel is named <code>append_to_file_in_ch</code> (<code>set{ append_to_file_in_ch }</code>)</li>
</ul></li>
<li>The channel <code>append_to_file_in_ch</code> is used as an input to the process <code>append_to_file</code>
<ul>
<li>The process <code>append_to_file</code> declares in input a tuple of three items, matching the cardinality of the items produced by the channel <code>append_to_file_in_ch</code></li>
<li>The output of the process <code>duplicate_lines</code> and the content of the column <code>content</code> in the sample sheet will now be matched correctly since they were joined using the matching key <code>id</code></li>
</ul></li>
</ul>
</div>
<div id="software-dependencies" class="section level2 hasAnchor" number="2.6">
<h2><span class="header-section-number">2.6</span> Software dependencies<a href="basic-features.html#software-dependencies" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We can do many things with just shell scripts, but for real-world scenarios, we would probably need to use some additional library or tool.
Software dependencies for a process can be specified in Nextflow in two main ways: using <a href="https://www.docker.com/resources/what-container/">software containers</a> or <a href="https://realpython.com/python-virtual-environments-a-primer/">virtual environments</a>.</p>
<p>A software container is like a shipping container: it is a monolithic block of code and data that contains everything needed to run a specific application, including the operating system (but not the kernel, the host kernel is used). The most popular container engine (the software that is used to actually run a container) is <a href="https://www.docker.com/">Docker</a>. In high-performance clusters, for security reasons, Docker is often discouraged or forbidden. A popular alternative container engine used in bioinformatics is <a href="https://sylabs.io/singularity/">Singularity</a>. The good news is that Singularity is also able to run containers created with Docker, so we can consider them equivalent for our purposes.</p>
<p>For popular tools, a container has most probably already been created by someone and put in a public container registry like <a href="https://hub.docker.com/">DockerHub</a>. In this case, we can provide Nextflow with just a link to the container and it will do the rest.
In case we wanted to use a custom container instead, we would have needed to write an appropriate description file for it (called a “Dockerfile”), use it to actually build the container, and then upload the container to DockerHub.
This last use case will not be treated in this workshop, and we will limit ourselves to the use of pre-built containers.</p>
<p>On the other hand, virtual environments are a more lightweight and modifiable alternative to containers.
They rely on the host operating system but they allow the definition of additional software.
Nextflow is compatible with <a href="https://docs.conda.io/en/latest/">Conda</a> environments, and can also use the faster <a href="https://mamba.readthedocs.io/en/latest/index.html">Mamba</a> implementation of Conda.
It is worth noting that while Conda and Mamba are typically thought of as package managers for Python, they are actually able to install also R packages, the R interpreter itself, stand-alone tools, and even GPU drivers.</p>
<p>Differently from containers, environments do not need to be pre-built to be used by Nextflow.
It is possible to just define the software that we need and Nextflow will take care to build an appropriate environment with it.</p>
<p>Let’s now write a workflow that makes use of virtual environments.</p>
<p>First download a CSV file containing a set of countries, their population, and their area by running the following</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb46-1"><a href="basic-features.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://raw.githubusercontent.com/saulpierotti-ebi/saulpierotti-ebi.github.io/main/assets/population_area_by_country.csv</span></code></pre></div>
<p>Now modify your <code>main.nf</code> file and make it look like this</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb47-1"><a href="basic-features.html#cb47-1" aria-hidden="true" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb47-2"><a href="basic-features.html#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="basic-features.html#cb47-3" aria-hidden="true" tabindex="-1"></a>process calculate_population_density <span class="op">{</span></span>
<span id="cb47-4"><a href="basic-features.html#cb47-4" aria-hidden="true" tabindex="-1"></a>    conda <span class="st">&quot;python=3.10.6 pandas=1.5.0&quot;</span></span>
<span id="cb47-5"><a href="basic-features.html#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="basic-features.html#cb47-6" aria-hidden="true" tabindex="-1"></a>    input<span class="op">:</span></span>
<span id="cb47-7"><a href="basic-features.html#cb47-7" aria-hidden="true" tabindex="-1"></a>        path csv_file</span>
<span id="cb47-8"><a href="basic-features.html#cb47-8" aria-hidden="true" tabindex="-1"></a>    output<span class="op">:</span></span>
<span id="cb47-9"><a href="basic-features.html#cb47-9" aria-hidden="true" tabindex="-1"></a>        path <span class="st">&quot;</span><span class="ss">${</span>csv_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.with_density.csv&quot;</span></span>
<span id="cb47-10"><a href="basic-features.html#cb47-10" aria-hidden="true" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb47-11"><a href="basic-features.html#cb47-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb47-12"><a href="basic-features.html#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="st">        #!/usr/bin/env Python</span></span>
<span id="cb47-13"><a href="basic-features.html#cb47-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-14"><a href="basic-features.html#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="st">        import pandas</span></span>
<span id="cb47-15"><a href="basic-features.html#cb47-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-16"><a href="basic-features.html#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="st">        df = pandas.read_csv(&quot;</span><span class="ss">${</span>csv_file<span class="ss">}</span><span class="st">&quot;)</span></span>
<span id="cb47-17"><a href="basic-features.html#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="st">        df[&quot;density&quot;] = df[&quot;population&quot;] / df[&quot;area&quot;]</span></span>
<span id="cb47-18"><a href="basic-features.html#cb47-18" aria-hidden="true" tabindex="-1"></a><span class="st">        df.to_csv(&quot;</span><span class="ss">${</span>csv_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.with_density.csv&quot;)</span></span>
<span id="cb47-19"><a href="basic-features.html#cb47-19" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb47-20"><a href="basic-features.html#cb47-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb47-21"><a href="basic-features.html#cb47-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-22"><a href="basic-features.html#cb47-22" aria-hidden="true" tabindex="-1"></a>process plot_population_by_area <span class="op">{</span></span>
<span id="cb47-23"><a href="basic-features.html#cb47-23" aria-hidden="true" tabindex="-1"></a>    publishDir <span class="st">&quot;../nextflow_output/plots&quot;</span></span>
<span id="cb47-24"><a href="basic-features.html#cb47-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-25"><a href="basic-features.html#cb47-25" aria-hidden="true" tabindex="-1"></a>    conda <span class="st">&quot;r-base=4.1.3 r-tidyverse=1.3.2&quot;</span></span>
<span id="cb47-26"><a href="basic-features.html#cb47-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-27"><a href="basic-features.html#cb47-27" aria-hidden="true" tabindex="-1"></a>    input<span class="op">:</span></span>
<span id="cb47-28"><a href="basic-features.html#cb47-28" aria-hidden="true" tabindex="-1"></a>        path csv_file</span>
<span id="cb47-29"><a href="basic-features.html#cb47-29" aria-hidden="true" tabindex="-1"></a>    output<span class="op">:</span></span>
<span id="cb47-30"><a href="basic-features.html#cb47-30" aria-hidden="true" tabindex="-1"></a>        path <span class="st">&quot;</span><span class="ss">${</span>csv_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.pdf&quot;</span></span>
<span id="cb47-31"><a href="basic-features.html#cb47-31" aria-hidden="true" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb47-32"><a href="basic-features.html#cb47-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb47-33"><a href="basic-features.html#cb47-33" aria-hidden="true" tabindex="-1"></a><span class="st">        #!/usr/bin/env Rscript</span></span>
<span id="cb47-34"><a href="basic-features.html#cb47-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-35"><a href="basic-features.html#cb47-35" aria-hidden="true" tabindex="-1"></a><span class="st">        library(&quot;tidyverse&quot;)</span></span>
<span id="cb47-36"><a href="basic-features.html#cb47-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-37"><a href="basic-features.html#cb47-37" aria-hidden="true" tabindex="-1"></a><span class="st">        df &lt;- read_csv(&quot;</span><span class="ss">${</span>csv_file<span class="ss">}</span><span class="st">&quot;)</span></span>
<span id="cb47-38"><a href="basic-features.html#cb47-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-39"><a href="basic-features.html#cb47-39" aria-hidden="true" tabindex="-1"></a><span class="st">        ggplot(df, aes(x=area, y=population, label=country, size=density)) +</span></span>
<span id="cb47-40"><a href="basic-features.html#cb47-40" aria-hidden="true" tabindex="-1"></a><span class="st">            geom_text()</span></span>
<span id="cb47-41"><a href="basic-features.html#cb47-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-42"><a href="basic-features.html#cb47-42" aria-hidden="true" tabindex="-1"></a><span class="st">        ggsave(&quot;</span><span class="ss">${</span>csv_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.pdf&quot;)</span></span>
<span id="cb47-43"><a href="basic-features.html#cb47-43" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb47-44"><a href="basic-features.html#cb47-44" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb47-45"><a href="basic-features.html#cb47-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-46"><a href="basic-features.html#cb47-46" aria-hidden="true" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb47-47"><a href="basic-features.html#cb47-47" aria-hidden="true" tabindex="-1"></a>    input_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span> params<span class="op">.</span>input <span class="op">)</span></span>
<span id="cb47-48"><a href="basic-features.html#cb47-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">calculate_population_density</span><span class="op">(</span> input_ch <span class="op">)</span></span>
<span id="cb47-49"><a href="basic-features.html#cb47-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_population_by_area</span><span class="op">(</span> calculate_population_density<span class="op">.</span>out <span class="op">)</span></span>
<span id="cb47-50"><a href="basic-features.html#cb47-50" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Modify your <code>nextflow.config</code> by adding the following</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb48-1"><a href="basic-features.html#cb48-1" aria-hidden="true" tabindex="-1"></a>conda <span class="op">{</span></span>
<span id="cb48-2"><a href="basic-features.html#cb48-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// use the faster mamba solver instead of conda</span></span>
<span id="cb48-3"><a href="basic-features.html#cb48-3" aria-hidden="true" tabindex="-1"></a>    useMamba <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb48-4"><a href="basic-features.html#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>If you want to see how your <code>nextflow.config</code> should look like at this stage open this hidden section</p>
<details>
<summary>
Code
</summary>
<div class="sourceCode" id="cb49"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb49-1"><a href="basic-features.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">// you can also put comments in nextflow.config</span></span>
<span id="cb49-2"><a href="basic-features.html#cb49-2" aria-hidden="true" tabindex="-1"></a>workDir <span class="op">=</span> <span class="st">&quot;../nextflow_workdir&quot;</span></span>
<span id="cb49-3"><a href="basic-features.html#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="basic-features.html#cb49-4" aria-hidden="true" tabindex="-1"></a>params <span class="op">{</span></span>
<span id="cb49-5"><a href="basic-features.html#cb49-5" aria-hidden="true" tabindex="-1"></a>  samplesheet <span class="op">=</span> <span class="st">&quot;../nextflow_inputs/samplesheet.csv&quot;</span></span>
<span id="cb49-6"><a href="basic-features.html#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb49-7"><a href="basic-features.html#cb49-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-8"><a href="basic-features.html#cb49-8" aria-hidden="true" tabindex="-1"></a>conda <span class="op">{</span></span>
<span id="cb49-9"><a href="basic-features.html#cb49-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// use the faster mamba solver instead of conda</span></span>
<span id="cb49-10"><a href="basic-features.html#cb49-10" aria-hidden="true" tabindex="-1"></a>    useMamba <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb49-11"><a href="basic-features.html#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</details>
<p>Now run the workflow as follows</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb50-1"><a href="basic-features.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="ex">nextflow</span> run main.nf <span class="at">--input</span> population_area_by_country.csv</span></code></pre></div>
<p>This time the workflow will take significantly longer to run since Nextflow needs to create two mamba environments.
However, this will affect only the first run of the workflow, since once an environment is created it can be used multiple times.
Now open the file <code>../nextflow_output/plots/population_area_by_country.pdf</code>.
It will contain a plot of the population of different countries versus their area, with the size proportional to their population density.</p>
<p>Let’s explore what happened:</p>
<ul>
<li>We specified to Nextflow to use Mamba instead than Conda when using the <code>conda</code> directive (with <code>conda{use.mamba = true}</code> in <code>nextflow.config</code>)</li>
<li>As before, we used a command-line flag to pass an input file to the workflow (<code>--input population_area_by_country.csv</code>)</li>
<li>We used <code>population_area_by_country.csv</code> as an input for the process <code>calculate_population_density</code>, which uses Python code to calculate the population density of a country from its area and total population</li>
<li>The output of <code>calculate_population_density</code> is fed to the process <code>plot_population_by_area</code>, which uses R code to produce the plot</li>
</ul>
<p>The <code>conda</code> directive used in these processes defines the software dependencies needed (in this case Python and <a href="https://pandas.pydata.org/">pandas</a> for the first process and R and <a href="https://www.tidyverse.org/">tidyverse</a> for the second process).
Software versions can be specified with an equal sign after the software name.
Packages are sourced from the repository <a href="https://anaconda.org/">Anaconda</a>.</p>
<p>Another thing to note here: the <code>script</code> directive normally interprets the code written in it as bash code, but if a <a href="https://www.wikiwand.com/en/Shebang_(Unix)">sh-bang</a> (<code>!#</code>) is included in the first line of the script, then the software specified in the sh-bang is used to run the script section (so <code>!#/usr/bin/env Python</code> tells to Nextflow to interpret the script section as Python code).</p>
<p>A different approach to reach the same goal is to write a separate Python or R script, place it in the <code>bin</code> folder, and then execute it with a bash command in the script directive.</p>
<p>So for example you can create a file called <code>bin/calculate_population_density.py</code> with the following content</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb51-1"><a href="basic-features.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas</span>
<span id="cb51-2"><a href="basic-features.html#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb51-3"><a href="basic-features.html#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="basic-features.html#cb51-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pandas.read_csv(sys.argv[<span class="dv">1</span>])</span>
<span id="cb51-5"><a href="basic-features.html#cb51-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;density&quot;</span>] <span class="op">=</span> df[<span class="st">&quot;population&quot;</span>] <span class="op">/</span> df[<span class="st">&quot;area&quot;</span>]</span>
<span id="cb51-6"><a href="basic-features.html#cb51-6" aria-hidden="true" tabindex="-1"></a>df.to_csv(sys.argv[<span class="dv">2</span>])</span></code></pre></div>
<p>Make it executable with</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb52-1"><a href="basic-features.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> +x bin/calculate_population_density.py</span></code></pre></div>
<p>And change the <code>calculate_population_density</code> process as follows</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb53-1"><a href="basic-features.html#cb53-1" aria-hidden="true" tabindex="-1"></a>process calculate_population_density <span class="op">{</span></span>
<span id="cb53-2"><a href="basic-features.html#cb53-2" aria-hidden="true" tabindex="-1"></a>    conda <span class="st">&quot;python=3.10.6 pandas=1.5.0&quot;</span></span>
<span id="cb53-3"><a href="basic-features.html#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="basic-features.html#cb53-4" aria-hidden="true" tabindex="-1"></a>    input<span class="op">:</span></span>
<span id="cb53-5"><a href="basic-features.html#cb53-5" aria-hidden="true" tabindex="-1"></a>        path csv_file</span>
<span id="cb53-6"><a href="basic-features.html#cb53-6" aria-hidden="true" tabindex="-1"></a>    output<span class="op">:</span></span>
<span id="cb53-7"><a href="basic-features.html#cb53-7" aria-hidden="true" tabindex="-1"></a>        path <span class="st">&quot;</span><span class="ss">${</span>csv_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.with_density.csv&quot;</span></span>
<span id="cb53-8"><a href="basic-features.html#cb53-8" aria-hidden="true" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb53-9"><a href="basic-features.html#cb53-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb53-10"><a href="basic-features.html#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="st">        ./calculate_population_density.py </span><span class="ss">$csv_file</span><span class="st"> </span><span class="ss">${</span>csv_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.with_density.csv</span></span>
<span id="cb53-11"><a href="basic-features.html#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb53-12"><a href="basic-features.html#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Running the following will yield the same result as before</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb54-1"><a href="basic-features.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="ex">nextflow</span> run main.nf <span class="at">--input</span> population_area_by_country.csv</span></code></pre></div>
<p>If we wanted to use containers instead than virtual environments for the process <code>calculate_population_density</code> to specify our software dependencies, we could have just replaced the line</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb55-1"><a href="basic-features.html#cb55-1" aria-hidden="true" tabindex="-1"></a>conda <span class="st">&quot;python=3.10.6 pandas=1.5.0&quot;</span></span></code></pre></div>
<p>with the line</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb56-1"><a href="basic-features.html#cb56-1" aria-hidden="true" tabindex="-1"></a>container <span class="st">&quot;docker://amancevice/pandas&quot;</span></span></code></pre></div>
<p>And then we would need to either set <code>docker{enabled = true}</code> or <code>singularity{enabled = true}</code> on our <code>nextflow.config</code> file, or we could specify the flag <code>-with-docker</code> or <code>-with-singularity</code> from the command line.
A similar approach would work also for the process <code>plot_population_by_area</code>, using for example the container <code>docker:/rocker/tidyverse</code>.</p>
<p>Note that containers in the format <code>docker:/username/container</code> are pulled by Nextflow from DockerHub.
They can be used either with Docker or Singularity as a container engine.</p>
</div>
<div id="resource-allocation" class="section level2 hasAnchor" number="2.7">
<h2><span class="header-section-number">2.7</span> Resource allocation<a href="basic-features.html#resource-allocation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Resource allocation is very useful when our workflow is run on a high-performance cluster or in the cloud.
It is possible to specify the amount of <a href="https://www.wikiwand.com/en/Random-access_memory">RAM</a>, the number of <a href="https://www.wikiwand.com/en/Central_processing_unit">CPU cores</a>, and the running time required by a process.
These values are then used by Nextflow to reserve appropriate resources, such as for submitting a job to the cluster with the desired requirements.</p>
<p>Since we do not have a cluster environment available for this workshop, we will not try to implement an actual workflow using resource requirements (we could specify them also for a local workflow, but we would not see any effect).</p>
<p>An example process specifying resource requirements looks like this</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb57-1"><a href="basic-features.html#cb57-1" aria-hidden="true" tabindex="-1"></a>process calculate_population_density <span class="op">{</span></span>
<span id="cb57-2"><a href="basic-features.html#cb57-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// this can be in GB, MB, KB, TB, ...</span></span>
<span id="cb57-3"><a href="basic-features.html#cb57-3" aria-hidden="true" tabindex="-1"></a>    memory <span class="st">&quot;2 GB&quot;</span></span>
<span id="cb57-4"><a href="basic-features.html#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// this can be in second(s), minute(s), hour(s), day(s)</span></span>
<span id="cb57-5"><a href="basic-features.html#cb57-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// it is also possible to use abbreviations such as s, m, h, d</span></span>
<span id="cb57-6"><a href="basic-features.html#cb57-6" aria-hidden="true" tabindex="-1"></a>    time <span class="st">&quot;5 days&quot;</span></span>
<span id="cb57-7"><a href="basic-features.html#cb57-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// just an integer (note that this is not a string)</span></span>
<span id="cb57-8"><a href="basic-features.html#cb57-8" aria-hidden="true" tabindex="-1"></a>    cpus <span class="dv">4</span></span>
<span id="cb57-9"><a href="basic-features.html#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="basic-features.html#cb57-10" aria-hidden="true" tabindex="-1"></a>    input<span class="op">:</span></span>
<span id="cb57-11"><a href="basic-features.html#cb57-11" aria-hidden="true" tabindex="-1"></a>        path csv_file</span>
<span id="cb57-12"><a href="basic-features.html#cb57-12" aria-hidden="true" tabindex="-1"></a>    output<span class="op">:</span></span>
<span id="cb57-13"><a href="basic-features.html#cb57-13" aria-hidden="true" tabindex="-1"></a>        path <span class="st">&quot;</span><span class="ss">${</span>csv_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.with_density.csv&quot;</span></span>
<span id="cb57-14"><a href="basic-features.html#cb57-14" aria-hidden="true" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb57-15"><a href="basic-features.html#cb57-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb57-16"><a href="basic-features.html#cb57-16" aria-hidden="true" tabindex="-1"></a><span class="st">        ./calculate_population_density.py </span><span class="ss">$csv_file</span><span class="st"> </span><span class="ss">${</span>csv_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.with_density.csv</span></span>
<span id="cb57-17"><a href="basic-features.html#cb57-17" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb57-18"><a href="basic-features.html#cb57-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<div id="the-resume-feature" class="section level2 hasAnchor" number="2.8">
<h2><span class="header-section-number">2.8</span> The resume feature<a href="basic-features.html#the-resume-feature" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>One of the most powerful aspects of Nextflow is the resume feature.
This feature can be activated by adding the following to the <code>nextflow.config</code> file</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb58-1"><a href="basic-features.html#cb58-1" aria-hidden="true" tabindex="-1"></a>resume <span class="op">=</span> <span class="kw">true</span></span></code></pre></div>
<p>Alternatively, it is also possible to run the Nextflow command with the <code>-resume</code> flag.</p>
<p>We saw before that each task is executed by Nextflow in its own directory with a long alphanumeric name.
This name is not random, but it is a 128-bit <a href="https://www.wikiwand.com/en/Hash_function">hash number</a>.
This number is calculated from the following values:</p>
<ul>
<li>Input files</li>
<li>Command line string</li>
<li>Container ID</li>
<li>Conda environment</li>
<li>Environment modules</li>
<li>Any executed scripts in the bin directory</li>
</ul>
<p>So, any time one of such features of a process changes, the hash value and hence the working directory changes.</p>
<p>If a working directory with the same hash value as that of the task to be executed is found by Nextflow, and this folder contains all the required outputs declared in the <code>output</code> block of the process, and it contains a file called <code>.exitcode</code> containing a value of zero (this is created automatically by Nextflow to save the exit code of a task execution), then the task execution is skipped and the output files present in the directory are returned as if they were produced by the current task.</p>
<p>This feature allows resuming the execution of a previous failed run of a workflow from the last successful task, potentially saving a lot of computing time.
A more in-depth explanation of the resume feature is available <a href="https://www.nextflow.io/blog/2019/demystifying-nextflow-resume.html">here</a>.</p>
<p>To test the resume feature by ourselves, let’s modify our <code>main.nf</code> file as follows</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb59-1"><a href="basic-features.html#cb59-1" aria-hidden="true" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb59-2"><a href="basic-features.html#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="basic-features.html#cb59-3" aria-hidden="true" tabindex="-1"></a>process dumb_process <span class="op">{</span></span>
<span id="cb59-4"><a href="basic-features.html#cb59-4" aria-hidden="true" tabindex="-1"></a>    publishDir <span class="st">&quot;../nextflow_output&quot;</span></span>
<span id="cb59-5"><a href="basic-features.html#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="basic-features.html#cb59-6" aria-hidden="true" tabindex="-1"></a>    output<span class="op">:</span></span>
<span id="cb59-7"><a href="basic-features.html#cb59-7" aria-hidden="true" tabindex="-1"></a>        path <span class="st">&quot;out.txt&quot;</span></span>
<span id="cb59-8"><a href="basic-features.html#cb59-8" aria-hidden="true" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb59-9"><a href="basic-features.html#cb59-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb59-10"><a href="basic-features.html#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="st">        sleep 120</span></span>
<span id="cb59-11"><a href="basic-features.html#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="st">        echo &quot;Success!&quot; &gt; out.txt</span></span>
<span id="cb59-12"><a href="basic-features.html#cb59-12" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb59-13"><a href="basic-features.html#cb59-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb59-14"><a href="basic-features.html#cb59-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-15"><a href="basic-features.html#cb59-15" aria-hidden="true" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb59-16"><a href="basic-features.html#cb59-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dumb_process</span><span class="op">()</span></span>
<span id="cb59-17"><a href="basic-features.html#cb59-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Now you can run the workflow with <code>nextflow run main.nf</code>.
Our workflow just runs the process <code>dumb_process</code>, which does not take any input and declares a single output file, <code>out.txt</code>.
This execution will take 2 minutes since the script block of the process <code>dumb_process</code> contains the command <code>sleep 120</code>, which just waits for 2 minutes (120 seconds), before writing the line “Success!” to the file <code>out.txt</code>.
After the execution is complete, we can see that the line “Success!” is present in the output file by running</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb60-1"><a href="basic-features.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> ../nextflow_output/out.txt</span></code></pre></div>
<p>Now, to test the resume feature run again the workflow</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb61-1"><a href="basic-features.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="ex">nextflow</span> run main.nf <span class="at">-resume</span></span></code></pre></div>
<p>In this case, the execution will be much quicker since <code>process_dumb</code> is not actually executed.
Instead, the cached results obtained before are returned.</p>
</div>
<div id="nf-core-pipelines" class="section level2 hasAnchor" number="2.9">
<h2><span class="header-section-number">2.9</span> nf-core pipelines<a href="basic-features.html#nf-core-pipelines" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Many of the workflows that we need in our work as bioinformaticians are always the same.
Mapping sequencing reads to a reference genome and then performing variant calling is an example of this.</p>
<p>For such common use cases, very efficient Nextflow pipelines are already available, so there is no need to reinvent the wheel.
Community-curated pipelines can be found on the <a href="https://nf-co.re">nf-core</a> repository.
So for example for mapping reads to a reference and then performing variant calling we would use the <a href="https://nf-co.re/sarek"><code>nf-core/sarek</code> pipeline</a>.
These pipelines follow a standardised format where inputs are declared by the user in a sample sheet.
You can read each pipeline’s documentation in nf-core to learn more about the parameters available and the expected format of the sample sheet.</p>
<p>I cannot make you run an actual nf-core pipeline now since there is not a simple and self-contained pipeline that does not require additional data like sequencing files to be run. However, once you have some files to process and you wrote an appropriate sample sheet, running the pipeline is very easy, for example:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb62-1"><a href="basic-features.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="ex">nextflow</span> run nf-core/sarek</span></code></pre></div>
<p>Note that Nextflow is able to run workflows from <a href="https://github.com/">GitHub</a>, and <code>nf-core/sarek</code> in the command above is just a pointer to <a href="https://github.com/nf-core/sarek">this GitHub repository</a>.
Nextflow takes care of cloning the repository and running the <code>main.nf</code> file.</p>
<p>If you want to actually test running a pipeline written by someone else, run the following hello world pipeline:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb63-1"><a href="basic-features.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="ex">nextflow</span> run nextflow-io/hello</span></code></pre></div>
<p>This will just print “Hello World” in different languages to the terminal.
You can explore the code for this workflow <a href="https://github.com/nextflow-io/hello">here</a>.</p>
</div>
<div id="labels" class="section level2 hasAnchor" number="2.10">
<h2><span class="header-section-number">2.10</span> Labels<a href="basic-features.html#labels" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <code>label</code> directive is used in Nextflow to tag processes to which we want to apply specific configurations.
So for example going back to the process <code>calculate_population_density</code></p>
<div class="sourceCode" id="cb64"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb64-1"><a href="basic-features.html#cb64-1" aria-hidden="true" tabindex="-1"></a>process calculate_population_density <span class="op">{</span></span>
<span id="cb64-2"><a href="basic-features.html#cb64-2" aria-hidden="true" tabindex="-1"></a>    conda <span class="st">&quot;python=3.10.6 pandas=1.5.0&quot;</span></span>
<span id="cb64-3"><a href="basic-features.html#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="basic-features.html#cb64-4" aria-hidden="true" tabindex="-1"></a>    input<span class="op">:</span></span>
<span id="cb64-5"><a href="basic-features.html#cb64-5" aria-hidden="true" tabindex="-1"></a>        path csv_file</span>
<span id="cb64-6"><a href="basic-features.html#cb64-6" aria-hidden="true" tabindex="-1"></a>    output<span class="op">:</span></span>
<span id="cb64-7"><a href="basic-features.html#cb64-7" aria-hidden="true" tabindex="-1"></a>        path <span class="st">&quot;</span><span class="ss">${</span>csv_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.with_density.csv&quot;</span></span>
<span id="cb64-8"><a href="basic-features.html#cb64-8" aria-hidden="true" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb64-9"><a href="basic-features.html#cb64-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb64-10"><a href="basic-features.html#cb64-10" aria-hidden="true" tabindex="-1"></a><span class="st">        ./calculate_population_density.py </span><span class="ss">$csv_file</span><span class="st"> </span><span class="ss">${</span>csv_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.with_density.csv</span></span>
<span id="cb64-11"><a href="basic-features.html#cb64-11" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb64-12"><a href="basic-features.html#cb64-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Instead of hard-coding the <code>conda</code> directive into the process definition, we could have done as follows</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb65-1"><a href="basic-features.html#cb65-1" aria-hidden="true" tabindex="-1"></a>process calculate_population_density <span class="op">{</span></span>
<span id="cb65-2"><a href="basic-features.html#cb65-2" aria-hidden="true" tabindex="-1"></a>    label <span class="st">&quot;pandas&quot;</span></span>
<span id="cb65-3"><a href="basic-features.html#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="basic-features.html#cb65-4" aria-hidden="true" tabindex="-1"></a>    input<span class="op">:</span></span>
<span id="cb65-5"><a href="basic-features.html#cb65-5" aria-hidden="true" tabindex="-1"></a>        path csv_file</span>
<span id="cb65-6"><a href="basic-features.html#cb65-6" aria-hidden="true" tabindex="-1"></a>    output<span class="op">:</span></span>
<span id="cb65-7"><a href="basic-features.html#cb65-7" aria-hidden="true" tabindex="-1"></a>        path <span class="st">&quot;</span><span class="ss">${</span>csv_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.with_density.csv&quot;</span></span>
<span id="cb65-8"><a href="basic-features.html#cb65-8" aria-hidden="true" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb65-9"><a href="basic-features.html#cb65-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb65-10"><a href="basic-features.html#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="st">        ./calculate_population_density.py </span><span class="ss">$csv_file</span><span class="st"> </span><span class="ss">${</span>csv_file<span class="op">.</span>simpleName<span class="ss">}</span><span class="st">.with_density.csv</span></span>
<span id="cb65-11"><a href="basic-features.html#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb65-12"><a href="basic-features.html#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>And then in the <code>nextflow.config</code> we could have written</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode groovy"><code class="sourceCode groovy"><span id="cb66-1"><a href="basic-features.html#cb66-1" aria-hidden="true" tabindex="-1"></a>withLabel<span class="op">:</span>pandas <span class="op">{</span></span>
<span id="cb66-2"><a href="basic-features.html#cb66-2" aria-hidden="true" tabindex="-1"></a>    conda <span class="op">=</span> <span class="st">&quot;python=3.10.6 pandas=1.5.0&quot;</span></span>
<span id="cb66-3"><a href="basic-features.html#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>This may seem of little benefit for a single process, but if we have many processes with similar requirements, using the <code>label</code> directive allows us to specify such requirements only once and in a central location.
So if for example we have several processes that need Python and pandas as software requirements, and we specified the requirements using the label directive, we can change the version of pandas used just by modifying what we wrote in the <code>nextflow.config</code> file, instead than having to modify the definition of many processes.</p>
<p>Note that the <code>label</code> directive can be used to specify many different configurations, not only software requirements.
For example, we could use it also for memory or time requirements.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="basic-challenge.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "night",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/saulpierotti-ebi/saulpierotti-ebi.github.io/blob/main/source/nextflow_workshop_ebi_predoc_course_2022/02-basic.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"info": true
});
});
</script>

</body>

</html>
